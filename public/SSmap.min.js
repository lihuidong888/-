!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SSmap=e()}(this,(function(){"use strict";let t={};window.Module=t;let e=[],i={};function n(t){return Math.PI/180*t}function o(t){return 180/Math.PI*t}function r(t){let e=Object.prototype.toString,i=Object.prototype.hasOwnProperty;return"[object Object]"===e.call(t)&&!(t.constructor&&!i.call(t.constructor.prototype,"isPrototypeOf"))}function s(t,e){if(!e)return t;let i=Object.keys(e);for(let n=0;n<i.length;n++){let o=i[n];r(e[o])?t[o]=s(t[o]||{},e[o]):t[o]=e[o]}return t}function a(t,e){e=e||0;let i=t.length-e;const n=new Array(i);for(;i--;)n[i]=t[i+e];return n}function l(t){if(!/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6}|[0-9A-Fa-f]{8})$/.test(t))return;let e=t.toLowerCase().replace(/\#/g,""),i=e.length;if(3==i){let t="";for(let n=0;n<i;n++)t+=e.slice(n,n+1).concat(e.slice(n,n+1));e=t,i=6}let n=[];6==i&&(e+="ff");for(let t=0;t<8;t+=2){let i=e.slice(t,t+2),o=parseInt("0x"+i);n.push(o)}return{r:n[0],g:n[1],b:n[2],a:n[3]}}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function c(t,e,i){i=i||2;var n,o,r,s,a,l,h,c=e&&e.length,y=c?e[0]*i:t.length,f=u(t,0,y,i,!0),m=[];if(!f||f.next===f.prev)return m;if(c&&(f=function(t,e,i,n){var o,r,s,a=[];for(o=0,r=e.length;o<r;o++)(s=u(t,e[o]*n,o<r-1?e[o+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(w(s));for(a.sort(v),o=0;o<a.length;o++)i=p(i=x(a[o],i),i.next);return i}(t,e,f,i)),t.length>80*i){n=r=t[0],o=s=t[1];for(var g=i;g<y;g+=i)(a=t[g])<n&&(n=a),(l=t[g+1])<o&&(o=l),a>r&&(r=a),l>s&&(s=l);h=0!==(h=Math.max(r-n,s-o))?1/h:0}return d(f,m,i,n,o,h),m}function u(t,e,i,n,o){var r,s;if(o===R(t,e,i,n)>0)for(r=e;r<i;r+=n)s=k(r,t[r],t[r+1],s);else for(r=i-n;r>=e;r-=n)s=k(r,t[r],t[r+1],s);return s&&P(s,s.next)&&(V(s),s=s.next),s}function p(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!P(n,n.next)&&0!==E(n.prev,n,n.next))n=n.next;else{if(V(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function d(t,e,i,n,o,r,s){if(t){!s&&r&&function(t,e,i,n){var o=t;do{null===o.z&&(o.z=_(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,i,n,o,r,s,a,l,h=1;do{for(i=t,t=null,r=null,s=0;i;){for(s++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(o=i,i=i.nextZ,a--):(o=n,n=n.nextZ,l--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;i=n}r.nextZ=null,h*=2}while(s>1)}(o)}(t,n,o,r);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,r?f(t,n,o,r):y(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),V(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?d(t=m(p(t),e,i),e,i,n,o,r,2):2===s&&g(t,e,i,n,o,r):d(p(t),e,i,n,o,r,1);break}}}function y(t){var e=t.prev,i=t,n=t.next;if(E(e,i,n)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(C(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&E(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function f(t,e,i,n){var o=t.prev,r=t,s=t.next;if(E(o,r,s)>=0)return!1;for(var a=o.x<r.x?o.x<s.x?o.x:s.x:r.x<s.x?r.x:s.x,l=o.y<r.y?o.y<s.y?o.y:s.y:r.y<s.y?r.y:s.y,h=o.x>r.x?o.x>s.x?o.x:s.x:r.x>s.x?r.x:s.x,c=o.y>r.y?o.y>s.y?o.y:s.y:r.y>s.y?r.y:s.y,u=_(a,l,e,i,n),p=_(h,c,e,i,n),d=t.prevZ,y=t.nextZ;d&&d.z>=u&&y&&y.z<=p;){if(d!==t.prev&&d!==t.next&&C(o.x,o.y,r.x,r.y,s.x,s.y,d.x,d.y)&&E(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,y!==t.prev&&y!==t.next&&C(o.x,o.y,r.x,r.y,s.x,s.y,y.x,y.y)&&E(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&C(o.x,o.y,r.x,r.y,s.x,s.y,d.x,d.y)&&E(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;y&&y.z<=p;){if(y!==t.prev&&y!==t.next&&C(o.x,o.y,r.x,r.y,s.x,s.y,y.x,y.y)&&E(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function m(t,e,i){var n=t;do{var o=n.prev,r=n.next.next;!P(o,r)&&z(o,n,n.next,r)&&A(o,r)&&A(r,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(r.i/i),V(n),V(n.next),n=t=r),n=n.next}while(n!==t);return p(n)}function g(t,e,i,n,o,r){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&M(s,a)){var l=L(s,a);return s=p(s,s.next),l=p(l,l.next),d(s,e,i,n,o,r),void d(l,e,i,n,o,r)}a=a.next}s=s.next}while(s!==t)}function v(t,e){return t.x-e.x}function x(t,e){var i=function(t,e){var i,n=e,o=t.x,r=t.y,s=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=o&&a>s){if(s=a,a===o){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(o===s)return i;var l,h=i,c=i.x,u=i.y,p=1/0;n=i;do{o>=n.x&&n.x>=c&&o!==n.x&&C(r<u?o:s,r,c,u,r<u?s:o,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(o-n.x),A(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&b(i,n)))&&(i=n,p=l)),n=n.next}while(n!==h);return i}(t,e);if(!i)return e;var n=L(i,t),o=p(i,i.next);return p(n,n.next),e===i?o:e}function b(t,e){return E(t.prev,t,e.prev)<0&&E(e.next,t,t.next)<0}function _(t,e,i,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function w(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function C(t,e,i,n,o,r,s,a){return(o-s)*(e-a)-(t-s)*(r-a)>=0&&(t-s)*(n-a)-(i-s)*(e-a)>=0&&(i-s)*(r-a)-(o-s)*(n-a)>=0}function M(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&z(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(A(t,e)&&A(e,t)&&function(t,e){var i=t,n=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&o<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(E(t.prev,t,e.prev)||E(t,e.prev,e))||P(t,e)&&E(t.prev,t,t.next)>0&&E(e.prev,e,e.next)>0)}function E(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function P(t,e){return t.x===e.x&&t.y===e.y}function z(t,e,i,n){var o=T(E(t,e,i)),r=T(E(t,e,n)),s=T(E(i,n,t)),a=T(E(i,n,e));return o!==r&&s!==a||(!(0!==o||!S(t,i,e))||(!(0!==r||!S(t,n,e))||(!(0!==s||!S(i,t,n))||!(0!==a||!S(i,e,n)))))}function S(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function T(t){return t>0?1:t<0?-1:0}function A(t,e){return E(t.prev,t,t.next)<0?E(t,e,t.next)>=0&&E(t,t.prev,e)>=0:E(t,e,t.prev)<0||E(t,t.next,e)<0}function L(t,e){var i=new O(t.i,t.x,t.y),n=new O(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function k(t,e,i,n){var o=new O(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function V(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function O(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(t,e,i,n){for(var o=0,r=e,s=i-n;r<i;r+=n)o+=(t[s]-t[r])*(t[r+1]+t[s+1]),s=r;return o}function N(t){let e=function(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y),e.push(t[i].z);let i=c(e,null,3),n=new Uint16Array(i.length);for(let t=0;t<i.length;t++)n[t]=i[t];return n}(t),i=0;for(let n=0;n<e.length;n+=3){let o=e[n],r=e[n+1],s=e[n+2],a=t[o],l=t[r],h=t[s];i+=D(F(a,l),F(l,h),F(h,a))}return i}function F(t,e){let i=Math.pow(t.x-e.x,2),n=Math.pow(t.y-e.y,2),o=Math.pow(t.z-e.z,2);return Math.sqrt(i+n+o)}function D(t,e,i){let n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))}function I(t,e,i){let n=Li.Vector3.subtract(e,t),o=Li.Vector3.subtract(e,i),r=n.normalize(),s=o.normalize(),a=Li.Vector3.dot(r,s);return 180*Math.acos(a)/Math.PI}function H(t,e,i,n){i=i||0,n=n||i;const o=Math.abs(t-e);return o<=n||o<=i*Math.max(Math.abs(t),Math.abs(e))}function B({points:t,height:e,color:i,opacity:n=1,castShadow:o=!1,waterShader:r=!1,objectName:s,tag:a,onTerrian:h}){let c=window.GlobalViewer.scene,u=new Li.Cartesian3Vector;t.forEach((t=>{h&&((t=t.toCartographic()).height=0),u.push_back(t.toCartesian3())}));let p=new Li.ExtrudeEntity;p.setOuter(u),p.extrudeHeight=e,p.create(),i=l(i),p.color=Li.Color.fromRgb(i.r,i.g,i.b,255),p.waterShader=r;let d=p.createEntity();return d.travalRenderers((function(t){1==o&&(t.castShadow=!0),t.material.opacity=n})),s&&(d.objectName=s),null!=a&&(d.tag=a+""),c.addEntity(d),u.delete(),p.delete(),d}function W(t,{offsetX:e=0,offsetY:i=0,offsetZ:n=0},o,r=1){let s=window.GlobalViewer.scene.globe,a=Li.Vector3.create(e,i,n),l=s.ellipsoid.eastNorthUpToFixedFrame(t.toCartesian3());if(o){let t=Li.Matrix4.fromTranslationRotationScale(Li.Vector3.create(0,0,0),o.toRotationMatrix(),Li.Vector3.create(r,r,r));l=Li.Matrix4.multiply(l,t)}return Li.Matrix4.multiplyByVector3(l,a)}function j(t){return t=t.map((t=>{let e=null;if(t instanceof Li.Vector3)e=t;else if(Array.isArray(t)){e=Li.Cartographic.fromDegrees(t[0],t[1],t[2]||0).toVector3()}else e=Li.Vector3.create(t.x,t.y,t.z);return e}))}function $(t){return Array.isArray(t[0])?t:t=t.map((t=>{let e=null;return t instanceof Li.Cartographic?e=t:t instanceof Li.Vector3?e=t.toCartographic():(e=Li.Vector3.create(t.x,t.y,t.z),e=e.toCartographic()),e=e.toDegrees(),[e.longitude,e.latitude]}))}function Z(t){return t.toCartographic().toDegrees()}function U(){if(!window.GlobalViewer)return;let t=window.GlobalViewer.scene.mainCamera;var e=new Li.RaycastHit,i=Module.qtCanvasElements[0]||window.GlobalViewer.canvasEl,n=t.screenPointToRay(i.offsetWidth/2,i.offsetHeight/2);window.GlobalViewer.scene.raycast(n,e);let o=null;return e&&(o=e.point),o}function Y(t){let e=document.getElementById("qtcanvas"),i=function(n){let o=n.x,r=n.y,s=window.GlobalViewer.scene,a=s.mainCamera.screenPointToRay(o,r),l=new Li.RaycastHit;if(s.raycast(a,l)){let e=l.point;t.call(this,e)}l.delete(),e.removeEventListener("click",i)};e.addEventListener("click",i)}function q(t,e){let i={};if("object"==typeof t&&"number"==typeof e)return t&&e&&(i.x=t.x*e,i.y=t.y*e,i.z=t.z*e),i}function J(t,e,i,n){let o=X(t),r=X(e),s=t===e,a=H(t.x,e.x,i,n),l=H(t.y,e.y,i,n),h=H(t.z,e.z,i,n);return s||o&&r&&a&&l&&h}function X(t){return null!=t}function G(t){let e=[];for(let i=0;i<4;i++){let n=t.column(i).x,o=t.column(i).y,r=t.column(i).z,s=t.column(i).w;e.push(n),e.push(o),e.push(r),e.push(s)}return e}function Q(){return Date.now()}function K(t){t._events=Object.create(null)}function tt(t){t.prototype.$on=function(t,e){const i=this;if(Array.isArray(t))for(let n=0,o=t.length;n<o;n++)i.$on(t[n],e);else(i._events[t]||(i._events[t]=[])).push(e);return i},t.prototype.$once=function(t,e){const i=this;function n(){i.$off(t,n),e.apply(i,arguments)}return n.fn=e,i.$on(t,n),i},t.prototype.$off=function(t,e){const i=this;if(!arguments.length)return i._events=Object.create(null),i;if(Array.isArray(t)){for(let n=0,o=t.length;n<o;n++)i.$off(t[n],e);return i}const n=i._events[t];if(!n)return i;if(!e)return i._events[t]=null,i;let o,r=n.length;for(;r--;)if(o=n[r],o===e||o.fn===e){n.splice(r,1);break}return i},t.prototype.$emit=function(t){const e=this;let i=e._events[t];if(i){i=i.length>1?a(i):i;const t=a(arguments,1);for(let n=0,o=i.length;n<o;n++){let o=i[n];t?o.apply(e,t):o.call(e)}}return e}}i.init=async function(e){if(!e.el||"object"!=typeof e.el)throw new Error("挂载元素不能为空");let n=document.createElement("canvas");function o(t){let i=e.path+t;return fetch(i).then((function(t){if(t.ok)return t}))}function r(t){return t.arrayBuffer().then((function(t){return WebAssembly.compile(t)}))}return n.id="qtcanvas",n.style.width="100%",n.style.height="100%",n.oncontextmenu=function(t){t.preventDefault()},e.el.appendChild(n),e.canvas=n,void 0===e.path&&(e.path="assets"),e.path.length>0&&!e.path.endsWith("/")&&(e.path=e.path.concat("/")),async function(i){let n=await(a=i+".js",o(a).then((function(t){return t.text()}))),s=await function(t){return o(t).then((function(t){return void 0!==WebAssembly.compileStreaming?WebAssembly.compileStreaming(t).catch((function(e){return r(t)})):r(t)}))}(i+".wasm");var a;!function(i,n){t.instantiateWasm=function(t,e){return WebAssembly.instantiate(n,t).then((function(t){e(t,n)})),{}},t.locateFile=t.locateFile||function(t){return e.path+t},t.print=t.print||function(t){e.stdoutEnabled&&console.log(t)},t.printErr=t.printErr||function(t){void 0!==t.startsWith&&t.startsWith("bad name in getProcAddress:")||e.stderrEnabled&&console.log(t)},t.mainScriptUrlOrBlob=new Blob([i],{type:"text/javascript"}),t.qtCanvasElements=[e.canvas],self.eval(i)}(n,s)}("teramap"),await new Promise((t=>{window.initScene=function(){let e=window.Li,o=window.location.href;for(const t in e)Object.hasOwnProperty.call(e,t)&&(i[t]=e[t]);window.GlobalViewer.canvasEl=n,i.extend(e,window.GlobalViewer),i.$baseUrl=o.substring(0,o.lastIndexOf("/")),window.SSmap=i,t([e,window.GlobalViewer])}}))},i.use=function(t){e.push(t)},i.extend=function(t,n){for(let t=0;t<e.length;t++)o(i,e[t]);function o(e,i){for(const r in i)"function"==typeof i[r]?e[r]=i[r](t,n):e[r]=o({},i[r]);return e}},c.deviation=function(t,e,i,n){var o=e&&e.length,r=o?e[0]*i:t.length,s=Math.abs(R(t,0,r,i));if(o)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,c=a<l-1?e[a+1]*i:t.length;s-=Math.abs(R(t,h,c,i))}var u=0;for(a=0;a<n.length;a+=3){var p=n[a]*i,d=n[a+1]*i,y=n[a+2]*i;u+=Math.abs((t[p]-t[y])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[y+1]-t[p+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},c.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var s=0;s<e;s++)i.vertices.push(t[o][r][s]);o>0&&(n+=t[o-1].length,i.holes.push(n))}return i};class et{constructor(t=0,e=0){et.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),o=this.x-t.x,r=this.y-t.y;return this.x=o*i-r*n+t.x,this.y=o*n+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}const it=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function nt(t,e,i){return Math.max(e,Math.min(i,t))}function ot(t,e,i){return(1-i)*t+i*e}class rt{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,o,r,s){let a=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=o[r+0],p=o[r+1],d=o[r+2],y=o[r+3];if(0===s)return t[e+0]=a,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===s)return t[e+0]=u,t[e+1]=p,t[e+2]=d,void(t[e+3]=y);if(c!==y||a!==u||l!==p||h!==d){let t=1-s;const e=a*u+l*p+h*d+c*y,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const o=Math.sqrt(n),r=Math.atan2(o,e*i);t=Math.sin(t*r)/o,s=Math.sin(s*r)/o}const o=s*i;if(a=a*t+u*o,l=l*t+p*o,h=h*t+d*o,c=c*t+y*o,t===1-s){const t=1/Math.sqrt(a*a+l*l+h*h+c*c);a*=t,l*=t,h*=t,c*=t}}t[e]=a,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,o,r){const s=i[n],a=i[n+1],l=i[n+2],h=i[n+3],c=o[r],u=o[r+1],p=o[r+2],d=o[r+3];return t[e]=s*d+h*c+a*p-l*u,t[e+1]=a*d+h*u+l*c-s*p,t[e+2]=l*d+h*p+s*u-a*c,t[e+3]=h*d-s*c-a*u-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,o=t._z,r=t._order,s=Math.cos,a=Math.sin,l=s(i/2),h=s(n/2),c=s(o/2),u=a(i/2),p=a(n/2),d=a(o/2);switch(r){case"XYZ":this._x=u*h*c+l*p*d,this._y=l*p*c-u*h*d,this._z=l*h*d+u*p*c,this._w=l*h*c-u*p*d;break;case"YXZ":this._x=u*h*c+l*p*d,this._y=l*p*c-u*h*d,this._z=l*h*d-u*p*c,this._w=l*h*c+u*p*d;break;case"ZXY":this._x=u*h*c-l*p*d,this._y=l*p*c+u*h*d,this._z=l*h*d+u*p*c,this._w=l*h*c-u*p*d;break;case"ZYX":this._x=u*h*c-l*p*d,this._y=l*p*c+u*h*d,this._z=l*h*d-u*p*c,this._w=l*h*c+u*p*d;break;case"YZX":this._x=u*h*c+l*p*d,this._y=l*p*c+u*h*d,this._z=l*h*d-u*p*c,this._w=l*h*c-u*p*d;break;case"XZY":this._x=u*h*c-l*p*d,this._y=l*p*c-u*h*d,this._z=l*h*d+u*p*c,this._w=l*h*c+u*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],o=e[8],r=e[1],s=e[5],a=e[9],l=e[2],h=e[6],c=e[10],u=i+s+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-a)*t,this._y=(o-l)*t,this._z=(r-n)*t}else if(i>s&&i>c){const t=2*Math.sqrt(1+i-s-c);this._w=(h-a)/t,this._x=.25*t,this._y=(n+r)/t,this._z=(o+l)/t}else if(s>c){const t=2*Math.sqrt(1+s-i-c);this._w=(o-l)/t,this._x=(n+r)/t,this._y=.25*t,this._z=(a+h)/t}else{const t=2*Math.sqrt(1+c-i-s);this._w=(r-n)/t,this._x=(o+l)/t,this._y=(a+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(nt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,o=t._z,r=t._w,s=e._x,a=e._y,l=e._z,h=e._w;return this._x=i*h+r*s+n*l-o*a,this._y=n*h+r*a+o*s-i*l,this._z=o*h+r*l+i*a-n*s,this._w=r*h-i*s-n*a-o*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,o=this._z,r=this._w;let s=r*t._w+i*t._x+n*t._y+o*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=r,this._x=i,this._y=n,this._z=o,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*o+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),h=Math.atan2(l,s),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=r*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=o*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(o),i*Math.cos(o),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class st{constructor(t=0,e=0,i=0){st.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(lt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(lt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,o=t.elements;return this.x=o[0]*e+o[3]*i+o[6]*n,this.y=o[1]*e+o[4]*i+o[7]*n,this.z=o[2]*e+o[5]*i+o[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,o=t.elements,r=1/(o[3]*e+o[7]*i+o[11]*n+o[15]);return this.x=(o[0]*e+o[4]*i+o[8]*n+o[12])*r,this.y=(o[1]*e+o[5]*i+o[9]*n+o[13])*r,this.z=(o[2]*e+o[6]*i+o[10]*n+o[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,o=t.x,r=t.y,s=t.z,a=t.w,l=a*e+r*n-s*i,h=a*i+s*e-o*n,c=a*n+o*i-r*e,u=-o*e-r*i-s*n;return this.x=l*a+u*-o+h*-s-c*-r,this.y=h*a+u*-r+c*-o-l*-s,this.z=c*a+u*-s+l*-r-h*-o,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n,this.y=o[1]*e+o[5]*i+o[9]*n,this.z=o[2]*e+o[6]*i+o[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,o=t.z,r=e.x,s=e.y,a=e.z;return this.x=n*a-o*s,this.y=o*r-i*a,this.z=i*s-n*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return at.copy(this).projectOnVector(t),this.sub(at)}reflect(t){return this.sub(at.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(nt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const at=new st,lt=new rt;class ht{constructor(){ht.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,n,o,r,s,a,l,h,c,u,p,d,y,f){const m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=n,m[1]=o,m[5]=r,m[9]=s,m[13]=a,m[2]=l,m[6]=h,m[10]=c,m[14]=u,m[3]=p,m[7]=d,m[11]=y,m[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ht).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/ct.setFromMatrixColumn(t,0).length(),o=1/ct.setFromMatrixColumn(t,1).length(),r=1/ct.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*o,e[5]=i[5]*o,e[6]=i[6]*o,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,o=t.z,r=Math.cos(i),s=Math.sin(i),a=Math.cos(n),l=Math.sin(n),h=Math.cos(o),c=Math.sin(o);if("XYZ"===t.order){const t=r*h,i=r*c,n=s*h,o=s*c;e[0]=a*h,e[4]=-a*c,e[8]=l,e[1]=i+n*l,e[5]=t-o*l,e[9]=-s*a,e[2]=o-t*l,e[6]=n+i*l,e[10]=r*a}else if("YXZ"===t.order){const t=a*h,i=a*c,n=l*h,o=l*c;e[0]=t+o*s,e[4]=n*s-i,e[8]=r*l,e[1]=r*c,e[5]=r*h,e[9]=-s,e[2]=i*s-n,e[6]=o+t*s,e[10]=r*a}else if("ZXY"===t.order){const t=a*h,i=a*c,n=l*h,o=l*c;e[0]=t-o*s,e[4]=-r*c,e[8]=n+i*s,e[1]=i+n*s,e[5]=r*h,e[9]=o-t*s,e[2]=-r*l,e[6]=s,e[10]=r*a}else if("ZYX"===t.order){const t=r*h,i=r*c,n=s*h,o=s*c;e[0]=a*h,e[4]=n*l-i,e[8]=t*l+o,e[1]=a*c,e[5]=o*l+t,e[9]=i*l-n,e[2]=-l,e[6]=s*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,i=r*l,n=s*a,o=s*l;e[0]=a*h,e[4]=o-t*c,e[8]=n*c+i,e[1]=c,e[5]=r*h,e[9]=-s*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-o*c}else if("XZY"===t.order){const t=r*a,i=r*l,n=s*a,o=s*l;e[0]=a*h,e[4]=-c,e[8]=l*h,e[1]=t*c+o,e[5]=r*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=s*h,e[10]=o*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(pt,t,dt)}lookAt(t,e,i){const n=this.elements;return mt.subVectors(t,e),0===mt.lengthSq()&&(mt.z=1),mt.normalize(),yt.crossVectors(i,mt),0===yt.lengthSq()&&(1===Math.abs(i.z)?mt.x+=1e-4:mt.z+=1e-4,mt.normalize(),yt.crossVectors(i,mt)),yt.normalize(),ft.crossVectors(mt,yt),n[0]=yt.x,n[4]=ft.x,n[8]=mt.x,n[1]=yt.y,n[5]=ft.y,n[9]=mt.y,n[2]=yt.z,n[6]=ft.z,n[10]=mt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,o=this.elements,r=i[0],s=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],p=i[13],d=i[2],y=i[6],f=i[10],m=i[14],g=i[3],v=i[7],x=i[11],b=i[15],_=n[0],w=n[4],C=n[8],M=n[12],E=n[1],P=n[5],z=n[9],S=n[13],T=n[2],A=n[6],L=n[10],k=n[14],V=n[3],O=n[7],R=n[11],N=n[15];return o[0]=r*_+s*E+a*T+l*V,o[4]=r*w+s*P+a*A+l*O,o[8]=r*C+s*z+a*L+l*R,o[12]=r*M+s*S+a*k+l*N,o[1]=h*_+c*E+u*T+p*V,o[5]=h*w+c*P+u*A+p*O,o[9]=h*C+c*z+u*L+p*R,o[13]=h*M+c*S+u*k+p*N,o[2]=d*_+y*E+f*T+m*V,o[6]=d*w+y*P+f*A+m*O,o[10]=d*C+y*z+f*L+m*R,o[14]=d*M+y*S+f*k+m*N,o[3]=g*_+v*E+x*T+b*V,o[7]=g*w+v*P+x*A+b*O,o[11]=g*C+v*z+x*L+b*R,o[15]=g*M+v*S+x*k+b*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],o=t[12],r=t[1],s=t[5],a=t[9],l=t[13],h=t[2],c=t[6],u=t[10],p=t[14];return t[3]*(+o*a*c-n*l*c-o*s*u+i*l*u+n*s*p-i*a*p)+t[7]*(+e*a*p-e*l*u+o*r*u-n*r*p+n*l*h-o*a*h)+t[11]*(+e*l*c-e*s*p-o*r*c+i*r*p+o*s*h-i*l*h)+t[15]*(-n*s*h-e*a*c+e*s*u+n*r*c-i*r*u+i*a*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],o=t[3],r=t[4],s=t[5],a=t[6],l=t[7],h=t[8],c=t[9],u=t[10],p=t[11],d=t[12],y=t[13],f=t[14],m=t[15],g=c*f*l-y*u*l+y*a*p-s*f*p-c*a*m+s*u*m,v=d*u*l-h*f*l-d*a*p+r*f*p+h*a*m-r*u*m,x=h*y*l-d*c*l+d*s*p-r*y*p-h*s*m+r*c*m,b=d*c*a-h*y*a-d*s*u+r*y*u+h*s*f-r*c*f,_=e*g+i*v+n*x+o*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=g*w,t[1]=(y*u*o-c*f*o-y*n*p+i*f*p+c*n*m-i*u*m)*w,t[2]=(s*f*o-y*a*o+y*n*l-i*f*l-s*n*m+i*a*m)*w,t[3]=(c*a*o-s*u*o-c*n*l+i*u*l+s*n*p-i*a*p)*w,t[4]=v*w,t[5]=(h*f*o-d*u*o+d*n*p-e*f*p-h*n*m+e*u*m)*w,t[6]=(d*a*o-r*f*o-d*n*l+e*f*l+r*n*m-e*a*m)*w,t[7]=(r*u*o-h*a*o+h*n*l-e*u*l-r*n*p+e*a*p)*w,t[8]=x*w,t[9]=(d*c*o-h*y*o-d*i*p+e*y*p+h*i*m-e*c*m)*w,t[10]=(r*y*o-d*s*o+d*i*l-e*y*l-r*i*m+e*s*m)*w,t[11]=(h*s*o-r*c*o-h*i*l+e*c*l+r*i*p-e*s*p)*w,t[12]=b*w,t[13]=(h*y*n-d*c*n+d*i*u-e*y*u-h*i*f+e*c*f)*w,t[14]=(d*s*n-r*y*n-d*i*a+e*y*a+r*i*f-e*s*f)*w,t[15]=(r*c*n-h*s*n+h*i*a-e*c*a-r*i*u+e*s*u)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,o=t.z;return e[0]*=i,e[4]*=n,e[8]*=o,e[1]*=i,e[5]*=n,e[9]*=o,e[2]*=i,e[6]*=n,e[10]*=o,e[3]*=i,e[7]*=n,e[11]*=o,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),o=1-i,r=t.x,s=t.y,a=t.z,l=o*r,h=o*s;return this.set(l*r+i,l*s-n*a,l*a+n*s,0,l*s+n*a,h*s+i,h*a-n*r,0,l*a-n*s,h*a+n*r,o*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,o,r){return this.set(1,i,o,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,o=e._x,r=e._y,s=e._z,a=e._w,l=o+o,h=r+r,c=s+s,u=o*l,p=o*h,d=o*c,y=r*h,f=r*c,m=s*c,g=a*l,v=a*h,x=a*c,b=i.x,_=i.y,w=i.z;return n[0]=(1-(y+m))*b,n[1]=(p+x)*b,n[2]=(d-v)*b,n[3]=0,n[4]=(p-x)*_,n[5]=(1-(u+m))*_,n[6]=(f+g)*_,n[7]=0,n[8]=(d+v)*w,n[9]=(f-g)*w,n[10]=(1-(u+y))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let o=ct.set(n[0],n[1],n[2]).length();const r=ct.set(n[4],n[5],n[6]).length(),s=ct.set(n[8],n[9],n[10]).length();this.determinant()<0&&(o=-o),t.x=n[12],t.y=n[13],t.z=n[14],ut.copy(this);const a=1/o,l=1/r,h=1/s;return ut.elements[0]*=a,ut.elements[1]*=a,ut.elements[2]*=a,ut.elements[4]*=l,ut.elements[5]*=l,ut.elements[6]*=l,ut.elements[8]*=h,ut.elements[9]*=h,ut.elements[10]*=h,e.setFromRotationMatrix(ut),i.x=o,i.y=r,i.z=s,this}makePerspective(t,e,i,n,o,r){const s=this.elements,a=2*o/(e-t),l=2*o/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(r+o)/(r-o),p=-2*r*o/(r-o);return s[0]=a,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,i,n,o,r){const s=this.elements,a=1/(e-t),l=1/(i-n),h=1/(r-o),c=(e+t)*a,u=(i+n)*l,p=(r+o)*h;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const ct=new st,ut=new ht,pt=new st(0,0,0),dt=new st(1,1,1),yt=new st,ft=new st,mt=new st;class gt{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),o=0;e.push(0);for(let r=1;r<=t;r++)i=this.getPoint(r/t),o+=i.distanceTo(n),e.push(o),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const o=i.length;let r;r=e||t*i[o-1];let s,a=0,l=o-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),s=i[n]-r,s<0)a=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(o-1);const h=i[n];return(n+(r-h)/(i[n+1]-h))/(o-1)}getTangent(t,e){const i=1e-4;let n=t-i,o=t+i;n<0&&(n=0),o>1&&(o=1);const r=this.getPoint(n),s=this.getPoint(o),a=e||(r.isVector2?new et:new st);return a.copy(s).sub(r).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new st,n=[],o=[],r=[],s=new st,a=new ht;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new st)}o[0]=new st,r[0]=new st;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),o[0].crossVectors(n[0],s),r[0].crossVectors(n[0],o[0]);for(let e=1;e<=t;e++){if(o[e]=o[e-1].clone(),r[e]=r[e-1].clone(),s.crossVectors(n[e-1],n[e]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(nt(n[e-1].dot(n[e]),-1,1));o[e].applyMatrix4(a.makeRotationAxis(s,t))}r[e].crossVectors(n[e],o[e])}if(!0===e){let e=Math.acos(nt(o[0].dot(o[t]),-1,1));e/=t,n[0].dot(s.crossVectors(o[0],o[t]))>0&&(e=-e);for(let i=1;i<=t;i++)o[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),r[i].crossVectors(n[i],o[i])}return{tangents:n,normals:o,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class vt extends gt{constructor(t=0,e=0,i=1,n=1,o=0,r=2*Math.PI,s=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=o,this.aEndAngle=r,this.aClockwise=s,this.aRotation=a}getPoint(t,e){const i=e||new et,n=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const r=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=n;for(;o>n;)o-=n;o<Number.EPSILON&&(o=r?0:n),!0!==this.aClockwise||r||(o===n?o=-n:o-=n);const s=this.aStartAngle+t*o;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}function xt(){let t=0,e=0,i=0,n=0;function o(o,r,s,a){t=o,e=s,i=-3*o+3*r-2*s-a,n=2*o-2*r+s+a}return{initCatmullRom:function(t,e,i,n,r){o(e,i,r*(i-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,r,s,a){let l=(e-t)/r-(i-t)/(r+s)+(i-e)/s,h=(i-e)/s-(n-e)/(s+a)+(n-i)/a;l*=s,h*=s,o(e,i,l,h)},calc:function(o){const r=o*o;return t+e*o+i*r+n*(r*o)}}}const bt=new st,_t=new xt,wt=new xt,Ct=new xt;function Mt(t,e,i,n,o){const r=.5*(n-e),s=.5*(o-i),a=t*t;return(2*i-2*n+r+s)*(t*a)+(-3*i+3*n-2*r-s)*a+r*t+i}function Et(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Pt(t,e,i,n,o){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,o)}class zt extends gt{constructor(t=new et,e=new et,i=new et,n=new et){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new et){const i=e,n=this.v0,o=this.v1,r=this.v2,s=this.v3;return i.set(Pt(t,n.x,o.x,r.x,s.x),Pt(t,n.y,o.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class St extends gt{constructor(t=new et,e=new et){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new et){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new et;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Tt extends gt{constructor(t=new et,e=new et,i=new et){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new et){const i=e,n=this.v0,o=this.v1,r=this.v2;return i.set(Et(t,n.x,o.x,r.x),Et(t,n.y,o.y,r.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class At extends gt{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new et){const i=e,n=this.points,o=(n.length-1)*t,r=Math.floor(o),s=o-r,a=n[0===r?r:r-1],l=n[r],h=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return i.set(Mt(s,a.x,l.x,h.x,c.x),Mt(s,a.y,l.y,h.y,c.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new et).fromArray(i))}return this}}var Lt=Object.freeze({__proto__:null,ArcCurve:class extends vt{constructor(t,e,i,n,o,r){super(t,e,i,i,n,o,r),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends gt{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new st){const i=e,n=this.points,o=n.length,r=(o-(this.closed?0:1))*t;let s,a,l=Math.floor(r),h=r-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:0===h&&l===o-1&&(l=o-2,h=1),this.closed||l>0?s=n[(l-1)%o]:(bt.subVectors(n[0],n[1]).add(n[0]),s=bt);const c=n[l%o],u=n[(l+1)%o];if(this.closed||l+2<o?a=n[(l+2)%o]:(bt.subVectors(n[o-1],n[o-2]).add(n[o-1]),a=bt),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),_t.initNonuniformCatmullRom(s.x,c.x,u.x,a.x,e,i,n),wt.initNonuniformCatmullRom(s.y,c.y,u.y,a.y,e,i,n),Ct.initNonuniformCatmullRom(s.z,c.z,u.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(_t.initCatmullRom(s.x,c.x,u.x,a.x,this.tension),wt.initCatmullRom(s.y,c.y,u.y,a.y,this.tension),Ct.initCatmullRom(s.z,c.z,u.z,a.z,this.tension));return i.set(_t.calc(h),wt.calc(h),Ct.calc(h)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new st).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:zt,CubicBezierCurve3:class extends gt{constructor(t=new st,e=new st,i=new st,n=new st){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new st){const i=e,n=this.v0,o=this.v1,r=this.v2,s=this.v3;return i.set(Pt(t,n.x,o.x,r.x,s.x),Pt(t,n.y,o.y,r.y,s.y),Pt(t,n.z,o.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},EllipseCurve:vt,LineCurve:St,LineCurve3:class extends gt{constructor(t=new st,e=new st){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new st){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Tt,QuadraticBezierCurve3:class extends gt{constructor(t=new st,e=new st,i=new st){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new st){const i=e,n=this.v0,o=this.v1,r=this.v2;return i.set(Et(t,n.x,o.x,r.x),Et(t,n.y,o.y,r.y),Et(t,n.z,o.z,r.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},SplineCurve:At});class kt extends gt{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new St(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let o=0;for(;o<n.length;){if(n[o]>=i){const t=n[o]-i,r=this.curves[o],s=r.getLength(),a=0===s?0:1-t/s;return r.getPointAt(a,e)}o++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,o=this.curves;n<o.length;n++){const r=o[n],s=r.isEllipseCurve?2*t:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?t*r.points.length:t,a=r.getPoints(s);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Lt[i.type]).fromJSON(i))}return this}}class Vt extends kt{constructor(t){super(),this.type="Path",this.currentPoint=new et,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new St(this.currentPoint.clone(),new et(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const o=new Tt(this.currentPoint.clone(),new et(t,e),new et(i,n));return this.curves.push(o),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,o,r){const s=new zt(this.currentPoint.clone(),new et(t,e),new et(i,n),new et(o,r));return this.curves.push(s),this.currentPoint.set(o,r),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new At(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,o,r){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,i,n,o,r),this}absarc(t,e,i,n,o,r){return this.absellipse(t,e,i,i,n,o,r),this}ellipse(t,e,i,n,o,r,s,a){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,o,r,s,a),this}absellipse(t,e,i,n,o,r,s,a){const l=new vt(t,e,i,n,o,r,s,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Ot extends Vt{constructor(t){super(t),this.uuid=function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(it[255&t]+it[t>>8&255]+it[t>>16&255]+it[t>>24&255]+"-"+it[255&e]+it[e>>8&255]+"-"+it[e>>16&15|64]+it[e>>24&255]+"-"+it[63&i|128]+it[i>>8&255]+"-"+it[i>>16&255]+it[i>>24&255]+it[255&n]+it[n>>8&255]+it[n>>16&255]+it[n>>24&255]).toLowerCase()}(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Vt).fromJSON(i))}return this}}const Rt="srgb",Nt="srgb-linear";function Ft(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Dt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const It={[Rt]:{[Nt]:Ft},[Nt]:{[Rt]:Dt}},Ht={legacyMode:!0,get workingColorSpace(){return Nt},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(It[e]&&void 0!==It[e][i]){const n=It[e][i];return t.r=n(t.r),t.g=n(t.g),t.b=n(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Bt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wt={r:0,g:0,b:0},jt={h:0,s:0,l:0},$t={h:0,s:0,l:0};function Zt(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Ut(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class Yt{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Ht.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n="srgb-linear"){return this.r=t,this.g=e,this.b=i,Ht.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n="srgb-linear"){var o;if(t=(t%(o=1)+o)%o,e=nt(e,0,1),i=nt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,o=2*i-n;this.r=Zt(o,n,t+1/3),this.g=Zt(o,n,t),this.b=Zt(o,n,t-1/3)}return Ht.toWorkingColorSpace(this,n),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const o=n[1],r=n[2];switch(o){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Ht.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Ht.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,o=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return i(t[4]),this.setHSL(n,o,r,e)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Ht.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Ht.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=Bt[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ft(t.r),this.g=Ft(t.g),this.b=Ft(t.b),this}copyLinearToSRGB(t){return this.r=Dt(t.r),this.g=Dt(t.g),this.b=Dt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return Ht.fromWorkingColorSpace(Ut(this,Wt),t),nt(255*Wt.r,0,255)<<16^nt(255*Wt.g,0,255)<<8^nt(255*Wt.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){Ht.fromWorkingColorSpace(Ut(this,Wt),e);const i=Wt.r,n=Wt.g,o=Wt.b,r=Math.max(i,n,o),s=Math.min(i,n,o);let a,l;const h=(s+r)/2;if(s===r)a=0,l=0;else{const t=r-s;switch(l=h<=.5?t/(r+s):t/(2-r-s),r){case i:a=(n-o)/t+(n<o?6:0);break;case n:a=(o-i)/t+2;break;case o:a=(i-n)/t+4}a/=6}return t.h=a,t.s=l,t.l=h,t}getRGB(t,e="srgb-linear"){return Ht.fromWorkingColorSpace(Ut(this,Wt),e),t.r=Wt.r,t.g=Wt.g,t.b=Wt.b,t}getStyle(t="srgb"){return Ht.fromWorkingColorSpace(Ut(this,Wt),t),t!==Rt?`color(${t} ${Wt.r} ${Wt.g} ${Wt.b})`:`rgb(${255*Wt.r|0},${255*Wt.g|0},${255*Wt.b|0})`}offsetHSL(t,e,i){return this.getHSL(jt),jt.h+=t,jt.s+=e,jt.l+=i,this.setHSL(jt.h,jt.s,jt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(jt),t.getHSL($t);const i=ot(jt.h,$t.h,e),n=ot(jt.s,$t.s,e),o=ot(jt.l,$t.l,e);return this.setHSL(i,n,o),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function qt(t,e,i){i=i||2;var n,o,r,s,a,l,h,c=e&&e.length,u=c?e[0]*i:t.length,p=Jt(t,0,u,i,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,i,n){var o,r,s,a=[];for(o=0,r=e.length;o<r;o++)(s=Jt(t,e[o]*n,o<r-1?e[o+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(se(s));for(a.sort(ie),o=0;o<a.length;o++)i=Xt(i=ne(a[o],i),i.next);return i}(t,e,p,i)),t.length>80*i){n=r=t[0],o=s=t[1];for(var y=i;y<u;y+=i)(a=t[y])<n&&(n=a),(l=t[y+1])<o&&(o=l),a>r&&(r=a),l>s&&(s=l);h=0!==(h=Math.max(r-n,s-o))?1/h:0}return Gt(p,d,i,n,o,h),d}function Jt(t,e,i,n,o){var r,s;if(o===xe(t,e,i,n)>0)for(r=e;r<i;r+=n)s=me(r,t[r],t[r+1],s);else for(r=i-n;r>=e;r-=n)s=me(r,t[r],t[r+1],s);return s&&ce(s,s.next)&&(ge(s),s=s.next),s}function Xt(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!ce(n,n.next)&&0!==he(n.prev,n,n.next))n=n.next;else{if(ge(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function Gt(t,e,i,n,o,r,s){if(t){!s&&r&&function(t,e,i,n){var o=t;do{null===o.z&&(o.z=re(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,i,n,o,r,s,a,l,h=1;do{for(i=t,t=null,r=null,s=0;i;){for(s++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(o=i,i=i.nextZ,a--):(o=n,n=n.nextZ,l--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;i=n}r.nextZ=null,h*=2}while(s>1)}(o)}(t,n,o,r);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,r?Kt(t,n,o,r):Qt(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),ge(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?Gt(t=te(Xt(t),e,i),e,i,n,o,r,2):2===s&&ee(t,e,i,n,o,r):Gt(Xt(t),e,i,n,o,r,1);break}}}function Qt(t){var e=t.prev,i=t,n=t.next;if(he(e,i,n)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(ae(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&he(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function Kt(t,e,i,n){var o=t.prev,r=t,s=t.next;if(he(o,r,s)>=0)return!1;for(var a=o.x<r.x?o.x<s.x?o.x:s.x:r.x<s.x?r.x:s.x,l=o.y<r.y?o.y<s.y?o.y:s.y:r.y<s.y?r.y:s.y,h=o.x>r.x?o.x>s.x?o.x:s.x:r.x>s.x?r.x:s.x,c=o.y>r.y?o.y>s.y?o.y:s.y:r.y>s.y?r.y:s.y,u=re(a,l,e,i,n),p=re(h,c,e,i,n),d=t.prevZ,y=t.nextZ;d&&d.z>=u&&y&&y.z<=p;){if(d!==t.prev&&d!==t.next&&ae(o.x,o.y,r.x,r.y,s.x,s.y,d.x,d.y)&&he(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,y!==t.prev&&y!==t.next&&ae(o.x,o.y,r.x,r.y,s.x,s.y,y.x,y.y)&&he(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&ae(o.x,o.y,r.x,r.y,s.x,s.y,d.x,d.y)&&he(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;y&&y.z<=p;){if(y!==t.prev&&y!==t.next&&ae(o.x,o.y,r.x,r.y,s.x,s.y,y.x,y.y)&&he(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function te(t,e,i){var n=t;do{var o=n.prev,r=n.next.next;!ce(o,r)&&ue(o,n,n.next,r)&&ye(o,r)&&ye(r,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(r.i/i),ge(n),ge(n.next),n=t=r),n=n.next}while(n!==t);return Xt(n)}function ee(t,e,i,n,o,r){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&le(s,a)){var l=fe(s,a);return s=Xt(s,s.next),l=Xt(l,l.next),Gt(s,e,i,n,o,r),void Gt(l,e,i,n,o,r)}a=a.next}s=s.next}while(s!==t)}function ie(t,e){return t.x-e.x}function ne(t,e){var i=function(t,e){var i,n=e,o=t.x,r=t.y,s=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=o&&a>s){if(s=a,a===o){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(o===s)return i;var l,h=i,c=i.x,u=i.y,p=1/0;n=i;do{o>=n.x&&n.x>=c&&o!==n.x&&ae(r<u?o:s,r,c,u,r<u?s:o,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(o-n.x),ye(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&oe(i,n)))&&(i=n,p=l)),n=n.next}while(n!==h);return i}(t,e);if(!i)return e;var n=fe(i,t),o=Xt(i,i.next);return Xt(n,n.next),e===i?o:e}function oe(t,e){return he(t.prev,t,e.prev)<0&&he(e.next,t,t.next)<0}function re(t,e,i,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function se(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ae(t,e,i,n,o,r,s,a){return(o-s)*(e-a)-(t-s)*(r-a)>=0&&(t-s)*(n-a)-(i-s)*(e-a)>=0&&(i-s)*(r-a)-(o-s)*(n-a)>=0}function le(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ue(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(ye(t,e)&&ye(e,t)&&function(t,e){var i=t,n=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&o<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(he(t.prev,t,e.prev)||he(t,e.prev,e))||ce(t,e)&&he(t.prev,t,t.next)>0&&he(e.prev,e,e.next)>0)}function he(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ce(t,e){return t.x===e.x&&t.y===e.y}function ue(t,e,i,n){var o=de(he(t,e,i)),r=de(he(t,e,n)),s=de(he(i,n,t)),a=de(he(i,n,e));return o!==r&&s!==a||(!(0!==o||!pe(t,i,e))||(!(0!==r||!pe(t,n,e))||(!(0!==s||!pe(i,t,n))||!(0!==a||!pe(i,e,n)))))}function pe(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function de(t){return t>0?1:t<0?-1:0}function ye(t,e){return he(t.prev,t,t.next)<0?he(t,e,t.next)>=0&&he(t,t.prev,e)>=0:he(t,e,t.prev)<0||he(t,t.next,e)<0}function fe(t,e){var i=new ve(t.i,t.x,t.y),n=new ve(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function me(t,e,i,n){var o=new ve(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function ge(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ve(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xe(t,e,i,n){for(var o=0,r=e,s=i-n;r<i;r+=n)o+=(t[s]-t[r])*(t[r+1]+t[s+1]),s=r;return o}Yt.NAMES=Bt,qt.deviation=function(t,e,i,n){var o=e&&e.length,r=o?e[0]*i:t.length,s=Math.abs(xe(t,0,r,i));if(o)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,c=a<l-1?e[a+1]*i:t.length;s-=Math.abs(xe(t,h,c,i))}var u=0;for(a=0;a<n.length;a+=3){var p=n[a]*i,d=n[a+1]*i,y=n[a+2]*i;u+=Math.abs((t[p]-t[y])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[y+1]-t[p+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},qt.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var s=0;s<e;s++)i.vertices.push(t[o][r][s]);o>0&&(n+=t[o-1].length,i.holes.push(n))}return i};class be{static area(t){const e=t.length;let i=0;for(let n=e-1,o=0;o<e;n=o++)i+=t[n].x*t[o].y-t[o].x*t[n].y;return.5*i}static isClockWise(t){return be.area(t)<0}static triangulateShape(t,e){const i=[],n=[],o=[];_e(t),we(i,t);let r=t.length;e.forEach(_e);for(let t=0;t<e.length;t++)n.push(r),r+=e[t].length,we(i,e[t]);const s=qt(i,n);for(let t=0;t<s.length;t+=3)o.push(s.slice(t,t+3));return o}}function _e(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function we(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Ce{constructor(){this.type="ShapePath",this.color=new Yt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Vt,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,o,r){return this.currentPath.bezierCurveTo(t,e,i,n,o,r),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],o=new Ot;o.curves=n.curves,e.push(o)}return e}function n(t,e){const i=e.length;let n=!1;for(let o=i-1,r=0;r<i;o=r++){let i=e[o],s=e[r],a=s.x-i.x,l=s.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[r],a=-a,s=e[o],l=-l),t.y<i.y||t.y>s.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(s.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=s.x)return!0}}return n}const o=be.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===e)return i(r);let s,a,l;const h=[];if(1===r.length)return a=r[0],l=new Ot,l.curves=a.curves,h.push(l),h;let c=!o(r[0].getPoints());c=t?!c:c;const u=[],p=[];let d,y,f=[],m=0;p[m]=void 0,f[m]=[];for(let e=0,i=r.length;e<i;e++)a=r[e],d=a.getPoints(),s=o(d),s=t?!s:s,s?(!c&&p[m]&&m++,p[m]={s:new Ot,p:d},p[m].s.curves=a.curves,c&&m++,f[m]=[]):f[m].push({h:a,p:d[0]});if(!p[0])return i(r);if(p.length>1){let t=!1,e=0;for(let t=0,e=p.length;t<e;t++)u[t]=[];for(let i=0,o=p.length;i<o;i++){const o=f[i];for(let r=0;r<o.length;r++){const s=o[r];let a=!0;for(let o=0;o<p.length;o++)n(s.p,p[o].p)&&(i!==o&&e++,a?(a=!1,u[o].push(s)):t=!0);a&&u[i].push(s)}}e>0&&!1===t&&(f=u)}for(let t=0,e=p.length;t<e;t++){l=p[t].s,h.push(l),y=f[t];for(let t=0,e=y.length;t<e;t++)l.holes.push(y[t].h)}return h}}let Me={};const Ee=Math.PI/180;Me.transformSVGPath=function(t){const e=new Ce;let i,n,o,r=1,s=0,a=0,l=0,h=0,c=null,u=null,p=0,d=0,y=0,f=0,m=0,g=0,v=0,x=0,b=0;const _=t.length;function w(){let e,i,n,o=!1;for(;r<_&&(i=t.charCodeAt(r),44===i||32===i);)r++;for(e=45===i?r++:r;r<_;)if(i=t.charCodeAt(r),48<=i&&i<=57)r++;else{if(46!==i)return n=t.substring(e,r),o?parseFloat(n):parseInt(n);r++,o=!0}return n=t.substring(e),o?parseFloat(n):parseInt(n)}function C(){let e;for(;r<_&&(e=t.charCodeAt(r),44===e||32===e);)r++;return e=t.charCodeAt(r),45===e||48<=e&&e<=57}let M;for(i=t[0];r<=_;){switch(M=!0,i){case"M":s=w(),a=w(),e.moveTo(s,a),i="L",c=s,u=a;break;case"m":s+=w(),a+=w(),e.moveTo(s,a),i="l",c=s,u=a;break;case"Z":case"z":M=!1,s===c&&a===u||e.lineTo(c,u);break;case"L":case"H":case"V":l="V"===i?s:w(),h="H"===i?a:w(),e.lineTo(l,h),s=l,a=h;break;case"l":case"h":case"v":l="v"===i?s:s+w(),h="h"===i?a:a+w(),e.lineTo(l,h),s=l,a=h;break;case"C":p=w(),y=w();case"S":"S"===i&&(p=2*s-d,y=2*a-f),d=w(),f=w(),l=w(),h=w(),e.bezierCurveTo(p,y,d,f,l,h),s=l,a=h;break;case"c":p=s+w(),y=a+w();case"s":"s"===i&&(p=2*s-d,y=2*a-f),d=s+w(),f=a+w(),l=s+w(),h=a+w(),e.bezierCurveTo(p,y,d,f,l,h),s=l,a=h;break;case"Q":p=w(),y=w();case"T":"T"===i&&(p=2*s-p,y=2*a-y),l=w(),h=w(),e.quadraticCurveTo(p,y,l,h),s=l,a=h;break;case"q":p=s+w(),y=a+w();case"t":"t"===i&&(p=2*s-p,y=2*a-y),l=s+w(),h=a+w(),e.quadraticCurveTo(p,y,l,h),s=l,a=h;break;case"A":m=w(),g=w(),v=w()*Ee,x=w(),b=w(),l=w(),h=w(),m!==g&&console.warn("Forcing elliptical arc to be a circular one:",m,g),p=Math.cos(v)*(s-l)/2+Math.sin(v)*(a-h)/2,y=-Math.sin(v)*(s-l)/2+Math.cos(v)*(a-h)/2;let t=Math.sqrt((m*m*g*g-m*m*y*y-g*g*p*p)/(m*m*y*y+g*g*p*p));x===b&&(t=-t),d=t*m*y/g,f=t*-g*p/m,n=Math.cos(v)*d-Math.sin(v)*f+(s+l)/2,o=Math.sin(v)*d+Math.cos(v)*f+(a+h)/2;const r=new THREE.Vector2(1,0),_=new THREE.Vector2((p-d)/m,(y-f)/g);let C=Math.acos(r.dot(_)/r.length()/_.length());r.x*_.y-r.y*_.x<0&&(C=-C),r.x=(-p-d)/m,r.y=(-y-f)/g;let E=Math.acos(_.dot(r)/_.length()/r.length());_.x*r.y-_.y*r.x<0&&(E=-E),!b&&E>0&&(E-=2*Math.PI),b&&E<0&&(E+=2*Math.PI),e.absarc(n,o,m,C,C+E,b),s=l,a=h;break;default:throw new Error("Wrong path command: "+i)}M&&C()||(i=t[r++])}return e};let Pe={};function ze(){var t=1<=arguments.length?[].slice.call(arguments,0):[],e=t.shift(),i=t.shift();Error.apply(this,t),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(e)+", params: "+JSON.stringify(i)}Pe.version="0.5.0",Pe.defaults={doThrows:{invalidGeometry:!1}},ze.prototype=Error,Pe.errors={InvalidGeometryError:ze},Pe.isGeometryValid=function(t){return!(!t||!Object.keys(t).length)&&(!!t.type&&!!t.coordinates&&Array.isArray(t.coordinates)&&!!t.coordinates.length)},Pe.parse=function(t,e,i){var n,o,r=function(t,e){var i=t||{};for(var n in e)e.hasOwnProperty(n)&&!i[n]&&(i[n]=e[n]);return i}(e,this.defaults);if(Te.length=0,function(t){for(var e in t.geom={},t)t.hasOwnProperty(e)&&-1!==Se.indexOf(e)&&(t.geom[e]=t[e],delete t[e]);!function(t){for(var e in t)t.hasOwnProperty(e)&&("string"==typeof t[e]?Te.push(t[e]):"object"==typeof t[e]&&(Te.push(t[e][0]),Te.push(t[e][1])));if(0===Te.length)throw new Error("No geometry attributes specified")}(t.geom)}(r),o=function(t){var e;t.exclude||t.include?t.include?e=function(e){t.include.forEach((function(t){e[t]=this[t]}),this)}:t.exclude&&(e=function(e){for(var i in this)this.hasOwnProperty(i)&&-1===Te.indexOf(i)&&-1===t.exclude.indexOf(i)&&(e[i]=this[i])}):e=function(t){for(var e in this)this.hasOwnProperty(e)&&-1===Te.indexOf(e)&&(t[e]=this[e])};return function(){var i={};return e.call(this,i),t.extra&&function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}(i,t.extra),i}}(r),Array.isArray(t)?(n={type:"FeatureCollection",features:[]},t.forEach((function(t){n.features.push(Le({item:t,params:r,propFunc:o}))})),Ae(n,r)):Ae(n=Le({item:t,params:r,propFunc:o}),r),!i||"function"!=typeof i)return n;i(n)};var Se=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],Te=[];function Ae(t,e){if(e.crs&&function(t){if("name"===t.type){if(t.properties&&t.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}if("link"===t.type){if(t.properties&&t.properties.href&&t.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}throw new Error('Invald CRS. Type attribute must be "name" or "link"')}(e.crs)&&(e.isPostgres?t.geometry.crs=e.crs:t.crs=e.crs),e.bbox&&(t.bbox=e.bbox),e.extraGlobal)for(var i in t.properties={},e.extraGlobal)t.properties[i]=e.extraGlobal[i]}function Le(t){var e=t.item,i=t.params,n=t.propFunc,o={type:"Feature"};return o.geometry=Ve(e,i),o.properties=n.call(e),o}function ke(t){return/^.+\..+$/.test(t)}function Ve(t,e){var i={};for(var n in e.geom){var o=e.geom[n];if("string"==typeof o&&t.hasOwnProperty(o))"GeoJSON"===n?i=t[o]:(i.type=n,i.coordinates=t[o]);else if("object"!=typeof o||Array.isArray(o)){if(Array.isArray(o)&&t.hasOwnProperty(o[0])&&t.hasOwnProperty(o[1]))i.type=n,i.coordinates=[Number(t[o[1]]),Number(t[o[0]])];else if(Array.isArray(o)&&ke(o[0])&&ke(o[1])){for(var r=[],s=0;s<o.length;s++){for(var a=o[s].split("."),l=t,h=0;h<a.length;h++){if(!l.hasOwnProperty(a[h]))return!1;l=l[a[h]]}r[s]=l}i.type=n,i.coordinates=[Number(r[1]),Number(r[0])]}}else{var c=Object.keys(o).map((function(e){var i=o[e];return Ve(t[e],{geom:{Point:i}})}));i.type=n,i.coordinates=[].concat(c.map((function(t){return t.coordinates})))}}if(e.doThrows&&e.doThrows.invalidGeometry&&!Pe.isGeometryValid(i))throw new ze(t,e);return i}function Oe(t){this._viewer=t||viewer,this._cameraEventWaitTime=500,this._cameraStartFired=!1,this._cameraClone&&(this._cameraClone.delete(),this._cameraClone=null),this._cameraClone=this.clone(this._viewer.scene.mainCamera),this._cameraMovedTime=void 0;let e=this;this._frameAction=this._viewer.addEventListener("update",(function(){e._checkForCameraUpdates(e._viewer.scene)}))}Oe.prototype._maxComponent=function(t,e){var i=Math.max(Math.abs(t.x),Math.abs(e.x)),n=Math.max(Math.abs(t.y),Math.abs(e.y)),o=Math.max(Math.abs(t.z),Math.abs(e.z));return Math.max(Math.max(i,n),o)},Oe.prototype._cameraEqual=function(t,e,i){let n=this._maxComponent(t.cameraController().positionWC,e.cameraController.positionWC);var o=1/Math.max(1,n);let r=J(q(t.cameraController().positionWC,o),q(e.cameraController.positionWC,o),i),s=J(t.cameraController().directionWC,e.cameraController.directionWC,i),a=J(t.cameraController().upWC,e.cameraController.upWC,i),l=J(t.cameraController().rightWC,e.cameraController.rightWC,i),h=function(t,e,i){i=i||0;let n=G(t),o=G(e);return n===o||X(n)&&X(o)&&Math.abs(n[0]-o[0])<=i&&Math.abs(n[1]-o[1])<=i&&Math.abs(n[2]-o[2])<=i&&Math.abs(n[3]-o[3])<=i&&Math.abs(n[4]-o[4])<=i&&Math.abs(n[5]-o[5])<=i&&Math.abs(n[6]-o[6])<=i&&Math.abs(n[7]-o[7])<=i&&Math.abs(n[8]-o[8])<=i&&Math.abs(n[9]-o[9])<=i&&Math.abs(n[10]-o[10])<=i&&Math.abs(n[11]-o[11])<=i&&Math.abs(n[12]-o[12])<=i&&Math.abs(n[13]-o[13])<=i&&Math.abs(n[14]-o[14])<=i&&Math.abs(n[15]-o[15])<=i}(t.transform.matrix,e._transformmatrix,i);return r&&s&&a&&l&&h},Oe.prototype._checkForCameraUpdates=function(t){var e=(t||viewer.scene).mainCamera,i=this._cameraClone;if(!this._cameraEqual(e,i,1e-15))return this._cameraStartFired||(this._moveStartraiseEvent&&(this._moveStartraiseEvent(),console.log("相机移动前")),this._cameraStartFired=!0),this._cameraMovedTime=Q(),this._cameraClone&&(this._cameraClone.delete(),this._cameraClone=null),this._cameraClone=this.clone(e),!0;let n=Q()-this._cameraMovedTime;return this._cameraStartFired&&n>this._cameraEventWaitTime&&(this._moveEndraiseEvent&&(this._moveEndraiseEvent(),console.log("相机移动后")),this._cameraStartFired=!1),!1},Oe.prototype.moveStart=function(t){"function"==typeof t?this._moveStartraiseEvent=t:console.error("RuntimeError","Argument is not a function")},Oe.prototype.moveEnd=function(t){"function"==typeof t?this._moveEndraiseEvent=t:console.error("RuntimeError","Argument is not a function")},Oe.prototype.clone=function(t){let e=new Li.Camera;return e.cameraController=t.cameraController(),e.aperture=t.aperture,e.shutterSpeed=t.shutterSpeed,e.sensitivity=t.sensitivity,e.nearPlane=t.nearPlane,e.farPlane=t.farPlane,e.fov=t.fov,e.aspectRatio=t.aspectRatio,e.left=t.left,e.right=t.right,e.bottom=t.bottom,e.top=t.top,e._transformmatrix=t.transform.matrix,e};let Re={Billboard:function(t,e){const i={center:"CENTER_V",bottom:"BOTTOM",baseLine:"BASELINE",top:"TOP"},n={center:"CENTER_H",left:"LEFT",right:"RIGHT"};let o=null,r=null;function a(t){if(this.instance=null,this._options=s({url:"",position:null,style:{mode:"OnTerrain",width:null,height:null,attitude:null,rotation:0,scale:1,align:"center",verticalAlign:"bottom"}},t),K(this),this._options.position){let t=j([this._options.position]);this.render(t[0])}else this.init(this._options)}return tt(a),a.prototype.init=function(){Y((t=>{this.render(t)}))},a.prototype.addProperty=function(t,e){this.instance&&this.instance.addProperty(t,e)},a.prototype.addProperties=function(t){if(this.instance)for(const e in t)Object.hasOwnProperty.call(t,e)&&this.addProperty(e,t[e])},a.prototype.render=function(e){let r=this,s=this._options.style,a=this._options.data,l=new Image;l.src=this._options.url,l.onload=function(){let h=new t.BillboardEntity;r.instance=h,h.url=r._options.url,h.position=e,h.imageWidth=s.width||l.width,h.imageHeight=s.height||l.height,h.rotation=s.rotation*(Math.PI/180),h.scale=s.scale,h.vertical=t.Vertical[i[s.verticalAlign]],h.horizontal=t.Horizontal[n[s.align]],h.altitudeMethod=t.AltitudeMethod[s.mode],s.attitude&&(h.altitude=s.attitude),a&&r.addProperties(a),o=o||t.BillboardCollection.Instance(),h.setCollection(o),r.$emit("end")}},a.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},a.removeAll=function(){o&&(o.removeAll(),o=null)},a.pick=function(i){if(!r){let n=e.canvasEl;r=function(){let n=e.scene.getFeatureByMouse();if(t.BillboardEntity.getSelect(n)){if(null==n||null==n)return;let t=n.propertyNames(),e=t.size(),o={};for(let i=0;i<e;i++){let e=t.get(i),r=n.getProperty(e);o[e]=r}i(o)}},n.addEventListener("click",r)}},a},Polyline:function(t,e){function i(t){this._options=s({positions:null,shapes:null,origin:null,closePath:!1,style:{mode:"Absolute",attitude:null,color:"#FF0000",alpha:1,width:2,offsetX:0,offsetY:0,scale:1,segment:12,dash:!1,depthTest:!0,glow:!1,animation:null}},t),this.cache={points:[],list:[]},K(this),this.init(this._options)}return tt(i),i.prototype.init=function(t){let i=this.cache,n=t.positions,o=t.style;if(n){let t=this.createPolyline3d(o);i.polyline=t,this.render(t,n),this.instance=t}else if(t.shape)this.shapeToPolyine(t);else{let t=this.createPolyline3d(o);i.polyline=t;let n=e.canvasEl,r=this.mousedownEvent.bind(this),s=this.mousemoveEvent.bind(this);i.mousedown=r,i.mousemove=s,n.style.cursor="crosshair";let a="左键拾取，右键结束";this.initTooltip(a),n.addEventListener("mousedown",r),document.addEventListener("mousemove",s)}},i.prototype.mousedownEvent=function(i){let n=this.cache;if(0==i.button){n.drawing=!0;let o=i.x,r=i.y,s=e.scene,a=s.mainCamera.screenPointToRay(o,r),l=new t.RaycastHit;if(s.raycast(a,l)){let t=l.point;n.polyline.addPoint(t),n.points.push(t),this.$emit("step",i,t)}l.delete()}2==i.button&&n.drawing&&this.rightMouseEvent()},i.prototype.mousemoveEvent=function(i){let n=this.cache,o=i.x,r=i.y,s=this.tooltip;if(s.style.display="block",s.style.left=o+5+"px",s.style.top=r+5+"px",0==n.points.length)return;let a=e.scene,l=a.mainCamera.screenPointToRay(o,r),h=new t.RaycastHit;if(a.raycast(l,h)){let t=h.point;n.polyline.lineTo(t)}h.delete()},i.prototype.rightMouseEvent=function(){let t=this.cache,e=t.points[t.points.length-1];t.polyline.addPoint(e),this._options.closePath&&t.polyline.addPoint(t.points[0]),t.polyline.draw(),t.polyline.end(),this.removeMouseEvent()},i.prototype.removeMouseEvent=function(){let t=this.cache,i=e.canvasEl;t.mousedown&&(i.removeEventListener("mousedown",t.mousedown),t.mousedown=null),t.mousemove&&(document.removeEventListener("mousemove",t.mousemove),t.mousemove=null),i.style.cursor="default",t.drawing=!1,this.removeTooltip(),this.$emit("end")},i.prototype.end=function(){this.removeMouseEvent()},i.prototype.initTooltip=function(t){let e=document.createElement("div");e.innerText=t,e.style.cssText="\n            position: absolute;\n            left: 0;\n            top: 0;\n            display: none;\n            padding: 3px 6px;\n            color: #fff;\n            background-color: rgba(20, 20, 20, 0.6);\n            font-size: 12px;\n        ",document.body.appendChild(e),this.tooltip=e},i.prototype.removeTooltip=function(){this.tooltip&&(document.body.removeChild(this.tooltip),this.tooltip=null)},i.prototype.createPolyline3d=function({mode:e,attitude:i,width:n,color:o,alpha:r,dash:s,animation:a,depthTest:h,glow:c}){let u=new t.Polyline3D;if(o=l(o),u.setWidth(n),u.color=t.Color.fromRgb(o.r,o.g,o.b,255),u.alpha=r,u.dash=s,u.animation=a,u.setGlowMaterial(c),a){let e=a.type||"HorizontalFlow";a.imgUrl&&u.setImageUrl(a.imgUrl),a.repeat&&u.setRepeat(a.repeat),u.animationRun=!0,u.animationType=t.AnimationType[e],u.animationTimer=a.duration||2e3}return u.depthTest=h,u.setAltitudeMethod(t.AltitudeMethod[e]),"Absolute"==e&&(u.attitude=i),u},i.prototype.shapeToPolyine=function(e){let i=this.cache,n=e.positions,o=e.shape,r=e.origin,s=e.style;if(!r)throw new Error("空间坐标参数origin为空！");o=Array.isArray(o)?o:[o],o.forEach(((e,o)=>{let a=this.createPolyline3d(s);0==o?i.polyline=a:i.list.push(a);let{shape:l,holes:h}=e.extractPoints(s.segment);r=j([r])[0];let c=t.Quaternion.fromEulerAngles(180,0,0);n=l.map((t=>W(r,{offsetX:t.x+s.offsetX,offsetY:t.y+s.offsetY},c,s.scale))),this.render(a,n),this.instance=a,h.forEach((t=>{let e=this.createPolyline3d(s);n=t.map((t=>W(r,{offsetX:t.x+s.offsetX,offsetY:t.y+s.offsetY},c,s.scale))),this.render(e,n),i.list.push(e)}))}))},i.prototype.render=function(e,i){let n=this.cache;i.forEach((i=>{let o=null;if(i instanceof t.Vector3)o=i;else if(Array.isArray(i)){o=t.Cartographic.fromDegrees(i[0],i[1],i[2]||0).toVector3()}else o=t.Vector3.create(i.x,i.y,i.z);e.addPoint(o),n.points.push(o)})),this._options.closePath&&e.addPoint(i[0]),e.addProperty("name","polyine"),e.draw(),e.end()},i.prototype.remove=function(){let t=this.cache;t.polyline&&(t.polyline.delete(),t.list.forEach((t=>{t.delete()})),t={points:[],list:[]})},i},Polygon:function(t,e){function i(t){this._options=s({type:"polygon",positions:null,origin:null,shapes:null,style:{mode:"Absolute",attitude:null,borderColor:"",color:"#00FF00",imgUrl:"",alpha:.99,fillAlpha:.99,waterShader:!1,offsetX:0,offsetY:0,scale:1,segment:12,repeat:0}},t),this.cache={points:[],list:[]},K(this),this.init(this._options)}return tt(i),i.prototype.init=function(t){let i=this.cache,n=t.positions;if(n){let t=this.render(n,"end");i.polygon=t}else if(t.shape)this.shapeToPolygon(t);else{let n=e.canvasEl,o=this.mousedownEvent.bind(this),r=this.mousemoveEvent.bind(this);i.mousedown=o,i.mousemove=r,n.style.cursor="crosshair";let s="左键拾取";"polygon"==t.type&&(s+="，右键结束"),this.initTooltip(s),n.addEventListener("mousedown",o),document.addEventListener("mousemove",r)}},i.prototype.mousedownEvent=function(i){let n=this.cache;if(0==i.button){n.drawing=!0;let o=i.x,r=i.y,s=e.scene,a=s.mainCamera.screenPointToRay(o,r),l=new t.RaycastHit;if(s.raycast(a,l)){let t=l.point;if(n.points.push(t),this.$emit("step",i,t),2==n.points.length&&"polygon"!=this._options.type)return void this.rightMouseEvent()}l.delete()}2==i.button&&n.drawing&&this.rightMouseEvent()},i.prototype.mousemoveEvent=function(i){let n=this.cache,o=i.x,r=i.y,s=this.tooltip;if(s.style.display="block",s.style.left=o+5+"px",s.style.top=r+5+"px",0==n.points.length)return;let a=e.scene,l=a.mainCamera.screenPointToRay(o,r),h=new t.RaycastHit;if(a.raycast(l,h)){let t=h.point;n.polygon&&n.polygon.delete();let e=this.render([...n.points,t]);n.polygon=e}h.delete()},i.prototype.rightMouseEvent=function(){let t=this.cache;t.polygon&&t.polygon.delete();let e=this.render(t.points,"end");t.polygon=e,this.removeMouseEvent()},i.prototype.removeMouseEvent=function(){let t=this.cache,i=e.canvasEl;t.mousedown&&(i.removeEventListener("mousedown",t.mousedown),t.mousedown=null),t.mousemove&&(document.removeEventListener("mousemove",t.mousemove),t.mousemove=null),i.style.cursor="default",t.drawing=!1,this.removeTooltip(),this.$emit("end")},i.prototype.end=function(){this.removeMouseEvent()},i.prototype.initTooltip=function(t){let e=document.createElement("div");e.innerText=t,e.style.cssText="\n            position: absolute;\n            left: 0;\n            top: 0;\n            display: none;\n            padding: 3px 6px;\n            color: #fff;\n            background-color: rgba(20, 20, 20, 0.6);\n            font-size: 12px;\n        ",document.body.appendChild(e),this.tooltip=e},i.prototype.removeTooltip=function(){this.tooltip&&(document.body.removeChild(this.tooltip),this.tooltip=null)},i.prototype.createPolygon3d=function({borderWidth:e,borderColor:i,color:n,alpha:o,fillAlpha:r,imgUrl:s,mode:a,waterShader:h,altitude:c,bottomHeight:u,limitHeight:p,repeat:d}){n=l(n),i=i?l(i):n;let y=new t.Polygon3D;return y.color=t.Color.fromRgb(i.r,i.g,i.b,255),e&&y.setWidth(e),y.alpha=o,y.setFillColor(t.Color.fromRgb(n.r,n.g,n.b,255)),y.fillAlpha=r,y.waterShader=h,s&&(y.fillMode=t.FillMode.FillImage,y.image=s,y.alpha=0,y.setRepeat(d)),c&&y.setAltitude(c),u&&y.setHeight(u),p&&y.setLimitHeight(p),y.setAltitudeMethod(t.AltitudeMethod[a]),y},i.prototype.shapeToPolygon=function(e){let i=this.cache,n=e.positions,o=e.shape,r=e.origin,s=e.style;if(!r)throw new Error("空间坐标参数origin为空！");o=Array.isArray(o)?o:[o],o.forEach(((e,o)=>{let{shape:a,holes:l}=e.extractPoints(s.segment);r=j([r])[0];let h=t.Quaternion.fromEulerAngles(180,0,0);n=a.map((t=>W(r,{offsetX:t.x+s.offsetX,offsetY:t.y+s.offsetY},h,s.scale)));let c=this.render(n,"end");0==o?(i.polygon=c,this.instance=c):i.list.push(c),l.forEach((t=>{n=t.map((t=>W(r,{offsetX:t.x+s.offsetX,offsetY:t.y+s.offsetY},h,s.scale)));let e=this.render(n,"end");i.list.push(e)}))}))},i.prototype.render=function(e,i){let n=this.cache,o=this._options.type,r=this.createPolygon3d(this._options.style);if("polygon"!=o&&2==e.length){let i=e[0],n=e[1],r=[];if("rect"==o){let e=i.toCartographic(),o=n.toCartographic(),s=(e.height+o.height)/2,a=t.Rectangle.create(0,0,0,0);a.combinePoint(e),a.combinePoint(o);let l=a.southwest();l.height=s;let h=a.northwest();h.height=s;let c=a.northeast();c.height=s;let u=a.southeast();u.height=s,r.push(l.toVector3(),h.toVector3(),c.toVector3(),u.toVector3()),a.delete()}else if("circle"==o){let e=t.Vector3.subtract(i,n);e=e.length();for(let t=0;t<=360;t+=1)if(t%3==0){let n=W(i,{offsetX:e*Math.cos(t*Math.PI/180),offsetY:e*Math.sin(t*Math.PI/180)});r.push(n)}}e=r}return e.forEach((e=>{let i=null;if(e instanceof t.Vector3)i=e;else if(Array.isArray(e)){i=t.Cartographic.fromDegrees(e[0],e[1],e[2]||0).toVector3()}else i=t.Vector3.create(e.x,e.y,e.z);r.addPoint(i)})),r.addProperty("name","polygon"),r.draw(),r.end(),this.instance=r,"end"==i&&(n.points=e),r},i.prototype.remove=function(){let t=this.cache;t.polygon&&(t.polygon.delete(),t.list.forEach((t=>{t.delete()})),t={points:[],list:[]},this.instance=null)},Object.defineProperties(i.prototype,{altitude:{get(){return this.instance.altitude()},set(t){this.instance&&this.instance.setAltitude(t)}},width:{get(){return this.instance.width()},set(t){this.instance&&this.instance.setWidth(t)}},fillColor:{set(t){if(this.instance){let e=l(t);this.instance.setFillColor(e)}}}}),i},ExtrudeEntity:function(t,e){function n(t){this._options=s({type:"entity",positions:null,shape:null,style:{imgUrl:"",roofMap:"",wallMap:"",color:"#00ffff",lineColor:"#00ffff",linewidth:2,opacity:.99,offsetX:0,offsetY:0,scale:1,castShadow:!1,waterShader:!1,baseHeight:0,gradient:!0,animation:null,objectName:"",tag:""}},t),this.cache={points:[],list:[]},this.instance=null,K(this),this.initData(this._options)}return tt(n),n.prototype.initData=function(t){let i=this.cache,n=t.positions;if(n){let e=j(n),i="outline"==t.type?this.drawBuildingOutline(e,this._options.style):this.extrudeEntity(e,this._options.style);this.instance=i}else if(t.shape)this.shapeToPolygon(t);else{let t=e.canvasEl,n=this.mousedownEvent.bind(this),o=this.mousemoveEvent.bind(this);i.mousedown=n,i.mousemove=o,t.style.cursor="crosshair";let r="左键拾取，右键结束";this.initTooltip(r),t.addEventListener("mousedown",n),document.addEventListener("mousemove",o)}},n.prototype.mousedownEvent=function(i){let n=this.cache;if(0==i.button){n.drawing=!0;let o=i.x,r=i.y,s=e.scene,a=s.mainCamera.screenPointToRay(o,r),l=new t.RaycastHit;if(s.raycast(a,l)){let t=l.point;if(n.volumeMoving)return n.alphaVolume.delete(),n.alphaVolume=null,this.removeMouseEvent(),this.$emit("end",n.points,n.volume.extrudeHeight),this.instance=n.volume,this._options.positions=n.points,void(n.volume=null);n.points.push(t),this.$emit("step",i,t)}l.delete()}if(2==i.button&&n.drawing&&!n.volumeMoving){if(n.points.length<3)return;this.rightMouseEvent()}},n.prototype.mousemoveEvent=function(n){let o=this.cache,r=n.x,s=n.y,a=this.tooltip;if(a.style.display="block",a.style.left=r+5+"px",a.style.top=s+5+"px",0==o.points.length)return;let l=e.scene,h=l.mainCamera.screenPointToRay(r,s),c=new t.RaycastHit;if(l.raycast(h,c)){let t=c.point;if(o.volumeMoving){o.volume&&(o.volume.delete(),o.volume=null);let e=t.toCartographic().height,i=Object.assign({},this._options.style,{height:e}),n=this.extrudeEntity(o.points,i);return n.extrudeHeight=e,o.volume=n,l.addEntity(n),void(n.name="volume")}o.polygon&&o.polygon.remove();let e=new i.graphic.Polygon({positions:[...o.points,t],style:{color:"#FF0000",mode:"Absolute",fillAlpha:.5}});o.polygon=e}c.delete()},n.prototype.rightMouseEvent=function(){let t=this.cache;if(!t.alphaVolume){let e=Object.assign({},this._options.style,{height:1e3,color:"#ffff00",opacity:0}),i=this.extrudeEntity(t.points,e);t.alphaVolume=i,i.name="alphaVolume",t.volumeMoving=!0}this.tooltip.innerText="移动拉伸，左键结束",t.polygon.remove(),t.polygon=null},n.prototype.removeMouseEvent=function(){let t=this.cache,i=e.canvasEl;t.mousedown&&(i.removeEventListener("mousedown",t.mousedown),t.mousedown=null),t.mousemove&&(document.removeEventListener("mousemove",t.mousemove),t.mousemove=null),i.style.cursor="default",t.drawing=!1,this.removeTooltip()},n.prototype.end=function(){this.removeMouseEvent()},n.prototype.initTooltip=function(t){let e=document.createElement("div");e.innerText=t,e.style.cssText="\n            position: absolute;\n            left: 0;\n            top: 0;\n            display: none;\n            padding: 3px 6px;\n            color: #fff;\n            background-color: rgba(20, 20, 20, 0.6);\n            font-size: 12px;\n        ",document.body.appendChild(e),this.tooltip=e},n.prototype.shapeToPolygon=function(e){let i=e.positions,n=e.shape,o=e.origin,r=e.style;if(!o)throw new Error("空间坐标参数origin为空！");{let{shape:s}=n.extractPoints(r.segment);o=j([o])[0];let a=t.Quaternion.fromEulerAngles(180,0,0);i=s.map((t=>W(o,{offsetX:t.x+r.offsetX,offsetY:t.y+r.offsetY},a,r.scale)));let l="outline"==e.type?this.drawBuildingOutline(i,r):this.extrudeEntity(i,r);this.instance=l}},n.prototype.drawBuildingOutline=function(e,i){let n=new t.Cartesian3Vector;e.forEach((t=>{"number"==typeof i.baseHeight&&((t=t.toCartographic()).height=i.baseHeight),n.push_back(t.toCartesian3())}));let o=new t.BuildingOutline;o.setOuter(n),o.extrudeHeight=i.height,o.altitude=i.baseHeight,o.url=i.imgUrl;let r=l(i.color);o.color=t.Color.fromRgb(r.r,r.g,r.b,255);let s=l(i.lineColor);o.strokeColor=t.Color.fromRgb(s.r,s.g,s.b,255),o.gradient=i.gradient,o.strokeWidth=i.linewidth,o.name=i.objectName,o.alpha=i.opacity;let a=i.animation;return a&&(o.animationRun=!0,o.animationType=t.AnimationType[a.type],o.animationTimer=a.duration||2e3,o.cw=a.cw),o.create(),o.parent=t.Entity.root(),n.delete(),o},n.prototype.extrudeEntity=function(i,n){let o=e.scene,r=new t.Cartesian3Vector;i.forEach((t=>{"number"==typeof n.baseHeight&&((t=t.toCartographic()).height=n.baseHeight),r.push_back(t.toCartesian3())}));let s=new t.ExtrudeEntity;s.setOuter(r),s.extrudeHeight=n.height,s.altitude=n.baseHeight;let a=l(n.color);s.color=t.Color.fromRgb(a.r,a.g,a.b,255),s.waterShader=n.waterShader,n.wallMap&&(s.wallMap=n.wallMap),n.roofMap&&(s.roofMap=n.roofMap),s.create();let h=s.createEntity();return h.travalRenderers((function(t){1==n.castShadow&&(t.castShadow=!0),t.material.opacity=n.opacity})),h.objectName=n.objectName,h.tag=n.tag,o.addEntity(h),r.delete(),s.delete(),h},n.prototype.removeTooltip=function(){this.tooltip&&(document.body.removeChild(this.tooltip),this.tooltip=null)},n.prototype.remove=function(){this.cache={points:[],list:[]},this.instance&&(this.instance.delete(),this.instance=null)},Object.defineProperties(n.prototype,{height:{get(){if(this.instance)return this.instance.extrudeHeight},set(t){this.instance&&this.instance.delete();let e=j(this._options.positions),i=Object.assign({},this._options.style,{height:t});this.instance=this.extrudeEntity(e,i)}}}),n},Shape:function(t,e){return Ot.createBySvg=function(t){return Me.transformSVGPath(t).toShapes(!0)},Ot},Path:function(t,e){return Vt},Label:function(t,e){const i={center:"CENTER_V",bottom:"BOTTOM",baseLine:"BASELINE",top:"TOP"},n={center:"CENTER_H",left:"LEFT",right:"RIGHT"};let o=null,r=null;function a(t){if(this.instance=null,this._options=s({url:"",position:null,mix:!1,style:{mode:"OnTerrain",width:null,height:null,attitude:null,rotation:0,scale:1,text:"",font:"Microsoft YaHei",fontSize:12,color:"#fff",strokeColor:"#000",backgroundColor:"#00000001",align:"center",verticalAlign:"bottom",textAlign:"center",textVertical:"top",offset:[0,0],fontBold:!1,fontItalic:!1,fontUnderline:!1}},t),K(this),this._options.position){let t=j([this._options.position]);this.render(t[0])}else this.init(this._options)}return tt(a),a.prototype.init=function(){Y((t=>{console.log(t),this.render(t)}))},a.prototype.addProperty=function(t,e){this.instance&&this.instance.addProperty(t,e)},a.prototype.addProperties=function(t){if(this.instance)for(const e in t)Object.hasOwnProperty.call(t,e)&&this.addProperty(e,t[e])},a.prototype.render=function(t){let e=this;if(this._options.url){let i=new Image;i.src=this._options.url,i.onload=function(){e.createLabel(t)}}else this.createLabel(t)},a.prototype.createLabel=function(e){let r=this._options.style,s=this._options.data,a=new t.Label3D;this.instance=a,a.position=e,a.url=this._options.url,a.imageWidth=r.width||img.width,a.imageHeight=r.height||img.height,a.font=r.font,a.fontSize=r.fontSize;let h=l(r.color);a.fontColor=t.Color.fromRgb(h.r,h.g,h.b,h.a);let c=l(r.strokeColor);a.strokeColor=t.Color.fromRgb(c.r,c.g,c.b,c.a);let u=l(r.backgroundColor);a.background=t.Color.fromRgb(u.r,u.g,u.b,u.a),a.fontBold=r.fontBold,a.fontItalic=r.fontItalic,a.fontUnderline=r.fontUnderline;let p=r.offset;a.offset=t.Cartesian2.create(p[0],p[1]),a.text=r.text,a.mix=r.mix,a.horizontal=t.Horizontal[n[r.align]],a.vertical=t.Vertical[i[r.verticalAlign]],a.textHorizontal=t.Horizontal[n[r.textAlign]],a.textVertical=t.Vertical[i[r.textVertical]],a.setAltitudeMethod(t.AltitudeMethod[r.mode]),"Absolute"==r.mode&&r.attitude&&a.setAltitude(r.attitude),s&&this.addProperties(s),o=o||t.BillboardCollection.Instance(),a.setCollection(o),this.$emit("end")},a.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},a.removeAll=function(){o&&(o.removeAll(),o=null)},a.pick=function(i){if(!r){let n=e.canvasEl;r=function(){let n=e.scene.getFeatureByMouse();if(t.Label3D.getSelect(n)){if(null==n||null==n)return;let t=n.propertyNames(),e=t.size(),o={};for(let i=0;i<e;i++){let e=t.get(i),r=n.getProperty(e);o[e]=r}i(o)}},n.addEventListener("click",r)}},a},GeoJsonModel:function(t,e){let i=null;function n(t){this.instance=null,this._options=s({iconUrl:"",selectedIconUrl:"",data:null,style:{width:null,height:null,offsetX:0,offsetY:0,attitude:10,highlight:!1,show:!0}},t),this.render(this._options.data)}return n.prototype.render=function(e){let i=this,n=this._options.style,o=new Image;o.src=this._options.iconUrl,o.onload=function(){let r=new t.GeoJsonModel;if(r.iconUrl=i._options.iconUrl,r.selectedIconUrl=i._options.selectedIconUrl,r.height=n.attitude,r.iconSize=t.Vector2.create(n.width||o.width,n.height||o.height),r.iconOffset=t.Vector2.create(n.offsetX,n.offsetY),r.show=n.show,r.highlight=n.highlight,Array.isArray(e)){let t=Pe.parse(e,{Point:["latitude","longitude"]}),i=[];e.forEach((t=>{for(const e in t)i.includes(e)||(i.push(e),r.addField(e))})),r.addString(JSON.stringify(t))}else r.load(e.url),e.keys.forEach((t=>{r.addField(t)}));i.instance=r}},n.prototype.setBase3DTileset=function(t){this.instance&&this.instance.setBase3DTileset(t)},n.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},Object.defineProperties(n.prototype,{highlight:{get(){return this.instance.highlight},set(t){this.instance.highlight=t}},show:{get(){return this.instance.show},set(t){this.instance.show=t}}}),n.pick=function(n){if(!i){let o=e.canvasEl;i=function(){let e=t.GeoJsonModel.getSelectedFeature();if(e){let t=e.propertyNames(),i=t.size(),o={};for(let n=0;n<i;n++){let i=t.get(n),r=e.getProperty(i);o[i]=r}n(o)}},o.addEventListener("click",i)}},n},PathEntity:function(t,e){function n(t){this._options=s({type:"rect",style:{color:"#007BE6",fillAlpha:.5}},t),this.instance=null,K(this),this.initData(this._options)}return tt(n),n.prototype.initData=function(t){let e=t.positions;if(e){let t=j(e);this.analyse(t)}else this.drawPolygon()},n.prototype.drawPolygon=function(){let t=this,e=this._options.style,n=new i.graphic.Polygon({type:this._options.type,style:{mode:"OnTerrain",color:e.color,alpha:e.fillAlpha,fillAlpha:e.fillAlpha}});return n.$on("end",(function(){t.analyse(this.cache.points),n.remove()})),n},n.prototype.analyse=function(e){let i=new t.SlopeAndAspect;e.forEach((t=>{i.add(t)})),i.create(),this.instance=i,this.$emit("end",this._options.type)},n.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},n}},Ne={ModelEntity:function(t,e){function i(t){this.model=null,this.modelCollection=[],this.EntityCollection=[],t&&this.add(t)}return i.prototype.add=function(i){let n=e.scene,o=new t.Model(i.url),r=new t.Entity;return r.addComponent(o),n.addEntity(r),i.srs?o.srs=i.srs:(this.model=o,this.transform(i)),o.entity.enabled=i.show||!0,this.modelCollection.push(o),this.EntityCollection.push(r),o},i.prototype.transform=function(e,i){let n=i||this.model,o=e.position,r=e.rotation,s=e.offset;if(!e.srs&&o){let e=t.Cartographic.fromDegrees(o.longitude,o.latitude,o.height);n.transform.cartographic=e}s&&(n.offset=t.Vector3.create(s.x,s.y,s.z)),r&&(n.rotation=t.Quaternion.fromEulerAngles(r.x,r.y,r.z)),e.scale&&(n.scale=t.Vector3.create(e.scale,e.scale,e.scale))},i.prototype.remove=function(){let t=this.EntityCollection.pop();this.modelCollection.pop(),t&&(t.delete(),this.modelCollection.length>0?this.model=this.modelCollection[this.modelCollection.length-1]:this.model=null)},i.prototype.removeAll=function(){for(let t=0;t<this.modelCollection.length;t++)this.remove(),t--;this.modelCollection=[],this.EntityCollection=[]},Object.defineProperties(i.prototype,{renderer:{get(){let t=[],e=null,i=this.model;for(t.push(i.entity);t.length;){let i=t.pop();if(i.renderer){e=i.renderer;break}let n=i.childEntities;for(let e=0;e<n.size();e++)t.push(n.get(e))}return e}},onloaded:{set(t){if("function"==typeof t){this.model.readyPromise.then((()=>{t.call(this)}))}}},show:{get(){return this.model.entity.enabled},set(t){this.model.entity.enabled=t}}}),i},Tiles3dLayer:function(t,e){function i(t){this.modelTiles=null,this.Tiles3dCollection=[],t&&this.add(t)}return i.prototype.add=function(i){let n=new t.Tileset(i.url);i.streamingMode&&(n.streamingMode=i.streamingMode||!0),i.skipLevelOfDetail&&(n.skipLevelOfDetail=i.skipLevelOfDetail||!0),i.genMeshNormals&&(n.genMeshNormals=i.genMeshNormals||!1),i.clipLevelOfDetail&&(n.clipLevelOfDetail=i.clipLevelOfDetail||!0),i.skipLevelOfRenderable&&(n.skipLevelOfRenderable=i.skipLevelOfRenderable||0),i.geometricErrorScale&&(n.geometricErrorScale=i.geometricErrorScale||1);let o=i.id||h();i.id=o,n.attr=i,this.modelTiles=n,this.show=null==i.show||i.show;let r=new t.Entity;r.addComponent(n),e.scene.addEntity(r),this.Tiles3dCollection.push(n)},i.prototype.transform=function(e,i){let n=e.offset||{x:0,y:0,z:0},o=e.rotation||{x:0,y:0,z:0},r=t.Quaternion.fromEulerAngles(o.x,o.y,o.z),s=t.Vector3.create(n.x,n.y,n.z),a=r.toRotationMatrix(),l=t.Matrix4.fromRotationTranslation(a,s);this.modelMatrix=l},i.prototype.remove=function(e){let i=e||this.Tiles3dCollection.pop();i instanceof t.Tileset&&(i.entity.delete(),this.Tiles3dCollection.length>0?this.modelTiles=this.Tiles3dCollection[this.Tiles3dCollection.length-1]:this.modelTiles=null)},i.prototype.removeAll=function(){for(let t=0;t<this.Tiles3dCollection.length;t++)this.remove(),t--;this.modelCollection=[],this.EntityCollection=[]},Object.defineProperties(i.prototype,{bounds:{get(){return this.modelTiles.rectangle.bounds()}},center:{get(){return this.modelTiles.rectangle.center()}},modelMatrix:{get(){let t=[],e=this.modelTiles.modelMatrix;for(let i=0;i<4;i++){let n=e.row(i);t.push(n.w),t.push(n.x),t.push(n.y),t.push(n.z)}return t},set(t){this.modelTiles.modelMatrix=t}},rectangle:{get(){let t={};for(let e in this.modelTiles.rectangle)if("east"==e||"south"==e||"west"==e||"north"==e){let i=this.modelTiles.rectangle[e];t[e]=i}return t}},show:{get(){return this.modelTiles.enabled},set(t){this.modelTiles.enabled=t}},onloaded:{set(t){if("function"==typeof t){this.modelTiles.readyPromise.then((()=>{t.call(this)}))}}}}),i},ImageryLayer:function(t,e){function i(t){if(t=t||{},this._viewer=e,this._scene=e.scene,this._rectangle=[-180,-90,180,90],this._useWebMercator=!1,this._maximumLevel=21,this._minimumLevel=0,this._tileWidth=256,this._tileHeight=256,this._hasAlphaChannel=!0,this._isLabel=!1,this._viewer)switch(this.ImageryLayerCollection=[],this.show=null,this.ImageryLayer=null,t.type){case"xyz":this.xyzLayer(t);break;case"wmts":this.wmtsLayer(t);break;case"dom-wmts":return;case"Tdt":this.TdtLayer(t);break;case"arcgis":this.ArcgisLayer(t);break;default:this.nowImageryLayer=null}else console.error("parametererror：","viewer is undefined")}return Object.defineProperty(i.prototype,"ImageryLayer",{get(){return this.ImageryLayerCollection.length>0?this.ImageryLayerCollection[this.ImageryLayerCollection.length-1]:void 0},set(t){this.ImageryLayer&&(this.ImageryLayer.remove(),this.ImageryLayerCollection[this.ImageryLayerCollection.length]=t)}}),Object.defineProperty(i.prototype,"show",{get(){var t=this._getshow();if(t)return this.ImageryLayer[t.name]},set(t){var e=this._getshow();e&&(this.ImageryLayer[e.name]=t)}}),i.prototype.TdtLayer=function(e,i){if(e=e||{},i||this._viewer){if(e.url){var n=new t.TiandituImageryLayer;n.url=e.url,n.useWebMercator=e.useWebMercator||this._useWebMercator,n.tileWidth=e.tileWidth||this._tileWidth,n.tileHeight=e.tileHeight||this._tileHeight,n.minimumLevel=null==e.minimumLevel?this._minimumLevel:e.minimumLevel,n.maximumLevel=e.maximumLevel||this._maximumLevel,n.hasAlphaChannel=e.hasAlphaChannel||this._hasAlphaChannel,n.isLabel=null==e.isLabel?this._isLabel:e.isLabel,n.componentComplete(),e.type="Tdt",n.attropt=e,this.ImageryLayerCollection.push(n)}}else console.error("parametererror：","viewer is undefined")},i.prototype.xyzLayer=function(e,i){e=e||{};var n=i||this._viewer;if(n){var o=e.rectangle||this._rectangle;let i=t.Rectangle.fromDegrees(o[0],o[1],o[2],o[3]);if(e.url){var r=e.url,s=new t.UrlTemplateImageryProvider(r,null==e.useWebMercator?this._useWebMercator:e.useWebMercator,e.maximumLevel||this._maximumLevel,null==e.minimumLevel?_minimumLevel:e.minimumLevel,e.tileWidth||this._tileWidth,e.tileHeight||this._tileHeight,null==e.hasAlphaChannel?this._hasAlphaChannel:e.hasAlphaChannel);e.licensekey&&(s.setUrlFunctor((function(t,i,n){return e.url+(n-9)+"/"+i+"/"+t+"?format=image%2Fpng"})),s.setHeader("szvsud-license-key",e.licensekey));var a=new t.ImageryLayer(s,i);e.type="xyz",a.attropt=e,n.scene.globe.addImageryLayer(a),this.ImageryLayerCollection.push(a)}}else console.error("parametererror：","viewer is undefined")},i.prototype.wmtsLayer=function(t,e){t=t||{};var i=e||this._viewer;if(i){if(t.url){var n=i.scene.globe.addWmsImageryLayer(t.url);t.type="wmts",n.attropt=t,this.ImageryLayerCollection.push(n)}}else console.error("parametererror：","viewer is undefined")},i.prototype.ArcgisLayer=function(t,e){t=t||{};var i=e||this._viewer;if(i){if(t.url){var n=i.scene.globe.addArcGisMapServerImageryLayer(t.url);t.type="arcgis",n.attropt=t,this.ImageryLayerCollection.push(n)}}else console.error("parametererror：","viewer is undefined")},i.prototype.showByType=function(t,e){for(var i=0;i<this.ImageryLayerCollection.length;i++){var n=this.ImageryLayerCollection[i];if(n.attropt.type===t)n[this._getshow(n).name]=e}},i.prototype.remove=function(t){var e=t||this.ImageryLayerCollection.pop();e?"Tdt"==(e.attropt||{}).type?e.delete():this._scene.globe.removeImageryLayer(e):console.error("运行错误：","影像已空")},i.prototype.removeByType=function(t){var e=[];this.ImageryLayerCollection.forEach((function(i,n){var o=i.attropt||{};if("Tdt"===o.type&&o.type===t){try{i.delete()}catch(t){}e.push(n)}else if(o.type===t){try{this._scene.globe.removeImageryLayer(i)}catch(t){}e.push(n)}}));for(var i=0;i<e.length;i++){var n=e[i];this.ImageryLayerCollection.splice(n,1)}},i.prototype.removeALL=function(){for(var t=0;t<this.ImageryLayerCollection.length;t++)this.remove()},i.prototype._getshow=function(t){var e=t||this.ImageryLayer;if(e)return"Tdt"==(e.attropt||{}).type?{name:"enabled"}:{name:"show"}},i},DomPopover:function(t,e){function i(t){this._options=s({type:1,style:{}},t),this.initQuequeClock(),this.elem=this.createElement(this._options)}return i.prototype.createElement=function(e){let i=document.createElement("div");if(2==e.type){let o=e.style,r=d(o.width)||180,s=d(o.height)||30,a=d(o.padding)||8,l=d(o.fontSize)||14,h=o.color||"#fff",c=o.borderColor||"#409EFF",u=o.backgroundColor||"rgba(64,158,255,0.5)";i.style.cssText=`\n                position: absolute;\n                width: ${r}px;\n                height: ${s}px;\n                text-align: justify;\n                font-size:${l}px;\n                color: ${h};\n                box-shadow: inset 0 0 0 1px ${c};\n                padding:${a}px;\n                background-color:${u};\n            `,i.className="ssmap_dom-popover-wrapper",i.innerHTML=e.text;let p=document.createElement("style");function d(t){return t?(t=t.split("px")[0],Number(t)):""}p.innerHTML=`\n                .ssmap_dom-popover-wrapper::before,\n                .ssmap_dom-popover-wrapper::after {\n                    content: "";\n                    position: absolute;\n                    top: 0;\n                    bottom: 0;\n                    left: 0;\n                    right: 0;\n                    margin: -${a}px;\n                    color: ${c};\n                    box-shadow: inset 0 0 0 2px;\n                    animation: ssmap__dom-popover-animation 8s linear infinite;\n                }\n                .ssmap_dom-popover-wrapper::before {\n                    animation-delay: -4s;\n                }\n                @keyframes ssmap__dom-popover-animation {\n                    0%,\n                    100% {\n                        clip: rect(0px, ${r+4*a}px, 2px, 0px);\n                    }\n                    25% {\n                        clip: rect(0px, 2px, ${s+4*a}px, 0px);\n                    }\n                    50% {\n                        clip: rect(${s+4*a}px, ${r+4*a}px, ${r+4*a}px,0px);\n                    }\n                    75% {\n                        clip: rect(0px, ${r+4*a}px, ${s+4*a}px, ${r+4*a}px);\n                    }\n                }\n            `,document.head.appendChild(p)}else if(3==e.type)i.style.position="absolute",i.innerHTML=e.html;else{let y=e.style,f=y.maxWidth||"180px",m=y.fontSize||"13px",g=y.color||"#fff",v=y.backgroundColor||"#409EFF";i.style.cssText=`\n                position: absolute;\n                font-size: ${m};\n                max-width: ${f};\n                color: ${g};\n                background: ${v};\n                border-radius: 4px;\n                padding: 10px;\n                z-index: 0;\n                line-height: 1.4;\n                min-width: 50px;\n                word-wrap: break-word;\n                text-align: justify;\n                cursor:pointer;\n            `,i.innerHTML=e.text;let x=document.createElement("span");x.style.cssText=`\n                position: absolute;\n                display: block;\n                width: 0;\n                height: 0;\n                border-color: ${v};\n                border-style: solid;\n                border-width: 8px;\n                left: 50%;\n                bottom: -7px;\n                transform: translateX(-50%) rotate(45deg);\n                z-index: -1;\n            `,i.appendChild(x)}let n=t.Cartographic.fromDegrees(e.position.longitude,e.position.latitude,e.position.height);return n=n.toVector3(),i.position=n,document.body.appendChild(i),window.SSMAP_DOM_POPOVER_ARRAY.push(i),i},i.prototype.remove=function(){let t=window.SSMAP_DOM_POPOVER_ARRAY;key=t.indexOf(this.elem),key>-1&&(t.splice(key,1),this.elem.remove())},i.prototype.initQuequeClock=function(){if(!window.SSMAP_DOM_POPOVER_ARRAY){window.SSMAP_DOM_POPOVER_ARRAY=[];let t=e.scene;window.SSMAP_DOM_POPOVER_ARRAY.updateHandler=e.addEventListener("update",(function(){window.SSMAP_DOM_POPOVER_ARRAY.forEach((e=>{let i=t.mainCamera.worldToScreenPoint(e.position);(i.z>1||i.z<-1)&&(i.x=-1e4),e.style.left=i.x-e.clientWidth/2+"px",e.style.top=i.y-e.clientHeight-15+"px"}))}))}},i.removeAll=function(){let t=window.SSMAP_DOM_POPOVER_ARRAY;t&&t.length>0&&(t.forEach((t=>{t.remove()})),e.removeEventListener(t.updateHandler),window.SSMAP_DOM_POPOVER_ARRAY=null)},i},Measure:function(t,e){function n(t){this._options=t,this.initData(t),K(this)}return tt(n),n.prototype.initData=function(t){let e="coordinate"==t.type?"左键获取坐标":"左键获取，右键结束";this.cache={distance:0,points:[],helperPoints:[],labelList:[],list:[]},this.mearsureType=t.type,this.initTooltip(e),this.initEvent(t)},n.prototype.initEvent=function(){let t=this.cache;if(t.mousedown)return;let i=e.canvasEl,n=this.mousedownEvent.bind(this),o=this.mousemoveEvent.bind(this);t.mousedown=n,t.mousemove=o,i.style.cursor="crosshair",i.addEventListener("mousedown",n),document.addEventListener("mousemove",o)},n.prototype.mousedownEvent=function(i){let n=this.cache;if(0==i.button){n.drawing=!0;let o=i.x,r=i.y,s=e.scene,a=s.mainCamera.screenPointToRay(o,r),l=new t.RaycastHit;if(s.raycast(a,l)){let e=l.point;if(n.volumeMoving)return this.calcVolume(n.volume),this.removeMouseEvent(),void this.$emit("end","volume");if("coordinate"==this.mearsureType)return this.drawCoordinate(e),this.removeMouseEvent(),void this.$emit("end","coordinate");if(n.polyline||(n.polyline=this.createPolyline3d(),n.list.push(n.polyline)),n.polyline.addPoint(e),this.drawClickPoint(this.mearsureType,e),n.points.push(e),"height"==this.mearsureType&&2==n.points.length){let t=n.points[0],e=n.points[1],i=t.toCartographic(),o=e.toCartographic(),r=" 高度差:"+Math.abs(o.height-i.height).toFixed(1)+"米 ",s=this.drawLabel3d({name:"height",position:n.points[1],text:r});return n.labelList.push(s),this.removeMouseEvent(),void this.$emit("end","height")}if("line"==this.mearsureType&&n.points.length>=2){let i=t.Cartesian3.distance(n.points[n.points.length-2].toCartesian3(),n.points[n.points.length-1].toCartesian3());n.distance+=i;let o=" "+n.distance.toFixed(1)+"m ",r=this.drawLabel3d({name:"line",position:e,text:o});n.labelList.push(r)}if("angle"==this.mearsureType&&n.points.length>=3){let t=" "+I(n.points[n.points.length-3],n.points[n.points.length-2],n.points[n.points.length-1]).toFixed(1)+"度 ",e=this.drawLabel3d({name:"angle",position:n.points[n.points.length-2],text:t});n.labelList.push(e)}}l.delete()}if(2==i.button&&n.drawing&&!n.volumeMoving){if("line"==this.mearsureType&&n.points.length<2)return;if("line"!=this.mearsureType&&n.points.length<3)return;this.rightMouseEvent()}},n.prototype.mousemoveEvent=function(i){let n=this.cache,o=i.x,r=i.y,s=this.tooltip;if(s.style.display="block",s.style.left=o+5+"px",s.style.top=r+5+"px",0==n.points.length)return;let a=e.scene,l=a.mainCamera.screenPointToRay(o,r),h=new t.RaycastHit;if(a.raycast(l,h)){let t=h.point;if(n.polyline.lineTo(t),n.volumeMoving){n.volume&&(n.volume.delete(),n.volume=null);let e=t.toCartographic().height,i=B({points:n.points,height:e,color:"#00ffff"});return i.extrudeHeight=e,n.volume=i,a.addEntity(i),void(i.name="volume")}"line"!=this.mearsureType&&"angle"!=this.mearsureType&&n.points.length>1&&this.drawPolygon3d(t)}h.delete()},n.prototype.removeMouseEvent=function(t){let i=this.cache,n=e.canvasEl;i.mousedown&&(n.removeEventListener("mousedown",i.mousedown),i.mousedown=null),i.mousemove&&(document.removeEventListener("mousemove",i.mousemove),i.mousemove=null),n.style.cursor="default",i.drawing=!1,this.removeTooltip()},n.prototype.rightMouseEvent=function(){let t=this.cache,e="line"==this.mearsureType||"angle"==this.mearsureType?t.points[t.points.length-1]:t.points[0];if(t.polyline.addPoint(e),t.polyline.draw(),t.polyline.end(),"line"==this.mearsureType&&this.$emit("end","line"),"angle"==this.mearsureType&&this.$emit("end","angle"),"line"!=this.mearsureType&&"angle"!=this.mearsureType){if("volume"==this.mearsureType){if(!t.alphaVolume){let e=B({points:t.points,height:2e3,color:"#000000",opacity:0});t.alphaVolume=e,e.name="alphaVolume",t.volumeMoving=!0}return this.tooltip.innerText="移动拉伸，左键结束",t.helperPoints.forEach((t=>{t.delete()})),t.helperPoints=[],t.polygon3d.delete(),void(t.polygon3d=null)}this.drawPolygon3d(),t.list.push(t.polygon3d),t.polygon3d=null;let e=N(t.points),i=this.getCenterPoint(t.points),n=" 面积："+e.toFixed(1)+"m² ",o=this.drawLabel3d({name:"area",position:i,text:n});t.labelList.push(o),this.$emit("end","area")}"volume"!=this.mearsureType&&this.removeMouseEvent()},n.prototype.initTooltip=function(t){let e=document.createElement("div");e.innerText=t,e.style.cssText="\n            position: absolute;\n            left: 0;\n            top: 0;\n            display: none;\n            padding: 3px 6px;\n            color: #fff;\n            background-color: rgba(20, 20, 20, 0.6);\n            font-size: 12px;\n        ",document.body.appendChild(e),this.tooltip=e},n.prototype.removeTooltip=function(){this.tooltip&&(document.body.removeChild(this.tooltip),this.tooltip=null)},n.prototype.drawClickPoint=function(e,n,o){let r=this.cache,s=new t.BillboardEntity;s.position=n,s.url=i.$baseUrl+"/assets/images/circle.png",s.vertical=!0,s.imageWidth=10,s.imageHeight=10,e&&(s.objectName=e,o?r.helperPoints.splice(o,0,s):r.helperPoints.push(s)),null==r.billboardCollection&&(r.billboardCollection=new t.BillboardCollection,r.list.push(r.billboardCollection)),s.setCollection(r.billboardCollection)},n.prototype.drawLabel3d=function({name:e,position:i,url:n,text:o,imageWidth:r,imageHeight:s,fontSize:a,color:l,background:h}){let c=this.cache,u=new t.Label3D;if(u.name=e,u.position=i,u.text=o,u.fontSize=a||11,u.fontColor=l||t.Color.fromRgb(0,0,0,255),u.background=h||t.Color.fromRgb(255,255,255,255),n&&(u.url=n,u.imageWidth=r,u.imageHeight=s),null==c.billboardCollection){let e=new t.BillboardCollection;c.billboardCollection=e,c.list.push(c.billboardCollection)}return u.setCollection(c.billboardCollection),u},n.prototype.createPolyline3d=function(e,i){let n=new t.Polyline3D;return n.setWidth(e||2.5),n.color=i||t.Color.fromRgb(252,20,20,255),n.setAltitudeMethod(t.AltitudeMethod.Absolute),n},n.prototype.createPolygon3d=function(){let e=new t.Polygon3D;return e.color=t.Color.fromRgb(0,0,0,128),e.alpha=.5,e.fillAlpha=.6,e.setFillColor(t.Color.fromRgb(255,255,255,56)),e},n.prototype.drawPolygon3d=function(t){let e=this.cache;e.polygon3d&&(e.polygon3d.delete(),e.polygon3d=null);let i=this.createPolygon3d();e.polygon3d=i,e.points.forEach((t=>{i.addPoint(t)})),t&&i.addPoint(t),i.draw(),i.end()},n.prototype.drawCoordinate=function(t){let e=this.cache,n=t.toCartographic().toDegrees(),o=" 经度："+n.longitude.toFixed(6)+" <br/>  纬度："+n.latitude.toFixed(6),r=new i.DomPopover({type:1,position:{longitude:n.longitude,latitude:n.latitude,height:n.height},text:o});e.labelElem=r},n.prototype.getCenterPoint=function(e){let i=[],n=[],o=[];e.forEach((t=>{let e=t.toCartographic().toDegrees();i.push(e.longitude),n.push(e.latitude),o.push(e.height)}));let r=(Math.min(...i)+Math.max(...i))/2,s=(Math.min(...n)+Math.max(...n))/2,a=(Math.min(...o)+Math.max(...o))/2;return t.Cartographic.fromDegrees(r,s,a).toVector3()},n.prototype.calcVolume=function(e){let i=this.cache,n=e.renderer,o=W(n.boundingVolume.boundingSphere.center,{offsetZ:e.extrudeHeight/2});t.GisUtil.calculateGeometryVolume(n).then((t=>{let e=" 体积："+t.toFixed(1).toString()+"m³ ";this.drawLabel3d({name:"volume",position:o,text:e})}));for(let e=0;e<i.list.length;e++){let n=i.list[e];if(n instanceof t.Polyline3D){n.delete(),i.list.splice(e,1);break}}i.list.push(i.volume),i.volume=null,i.alphaVolume.delete(),i.alphaVolume=null},n.prototype.remove=function(){let t=this.cache;t.polygon3d&&t.polygon3d.delete(),t.alphaVolume&&t.alphaVolume.delete(),t.volume&&t.volume.delete(),t.labelElem&&t.labelElem.remove(),[...t.helperPoints,...t.labelList,...t.list].forEach((t=>{t.delete()})),this.removeMouseEvent(),this.cache={distance:0,points:[],helperPoints:[],labelList:[],list:[]}},n},flyTo:function(t,e){function i(h,c){c=c||{};let u=e.scene.mainCamera.cameraController();if(h instanceof t.Vector3)u.flyTo(h,Number(c.duration)||3,Number(c.heading)||0,Number(c.pitch)||-90,Number(c.roll)||0);else if(h instanceof t.Cartographic)u.flyToCartographic(h,Number(c.duration)||3,Number(c.heading)||0,Number(c.pitch)||-90,Number(c.roll)||0);else if(h instanceof t.Cartesian3&&c.duration)u.flyTo(h.toVector3(),Number(c.duration)||3,Number(c.heading)||0,Number(c.pitch)||-90,Number(c.roll)||0);else if(!(h instanceof t.Cartesian3||h instanceof t.Cartographic||h instanceof t.Vector3)||c.duration&&0!=c.duration){if(h instanceof t.Rectangle)if(c.locaterect){let t=h.bounds();if(t){a(t.center.toCartesian3().toCartographic(),t.radius<=0?1:t.radius,c)}}else u.flyToRectangle(h,Number(c.duration)||0,Number(c.heading)||0,Number(c.pitch)||-90,Number(c.roll)||0);else if(h instanceof t.Model)s(h,c);else if(h instanceof SSmap.ModelEntity)s(h,c);else if(h instanceof t.Tileset)r(h,c);else if(h instanceof t.TilesetLayer)r(h=h.Tileset(),c);else if(h instanceof SSmap.Tiles3dLayer)r(h,c);else if(h instanceof t.BillboardEntity||h instanceof t.Label3D){let e=h.position,n=l(e,{offsetY:-120,offsetZ:160});!function(e,i){window.bbEntity=new t.BillboardEntity,window.bbEntity.position=i,window.bbEntity.url=SSmap.$baseUrl+"/assets/images/circle.png",window.bbEntity.vertical=!0,window.bbEntity.imageWidth=10,window.bbEntity.imageHeight=10,e&&(window.bbEntity.objectName=e);window.bbEntity.setCollection(t.BillboardCollection.Instance())}("point",n);let r=t.GisUtil.getPitch(n,e),s=t.GisUtil.getHeading(n,e),a=o(r),u=o(s);i(n,{duration:Number(c.duration)||0,heading:Number(u)||0,pitch:Number(a)||-89,roll:Number(c.roll)||0})}}else{let e=null;h instanceof t.Cartesian3?e=h:(h instanceof t.Cartographic||h instanceof t.Vector3)&&(e=h.toCartesian3()),u.setView(e,Number(n(c.heading||0)),Number(n(c.pitch||-90)),Number(n(c.roll||0)))}}function r(t,e){let i=t.bounds;if(i){a(t.center,i.radius<=0?1:i.radius,e)}}function s(e,n){n=n||{};let o=e.renderer;if(o){if(o instanceof t.GeometryRenderer){!function(t,e,n){if(n=n||{},t&&e){t.height=t.height+2.5*e;let o=t.toVector3();o=l(o,{offsetY:-2.5*e}),i(o,{duration:Number(n.duration)||0,heading:Number(n.heading)||0,pitch:Number(n.pitch)||-45,roll:Number(n.roll)||0})}}(o.boundingVolume.center.toCartesian3().toCartographic(),o.boundingVolume.boundingSphere.radius)}}else n.center&&(n.center instanceof t.Cartographic?i(n.center,{duration:Number(n.duration)||0,heading:Number(n.heading)||0,pitch:Number(-newpitch)||-45,roll:Number(n.roll)||0}):console.error("parametererror：","center不是Cartographic类型"))}function a(t,e,n){let o=function(t,e,i){i=i||{};let n=Math.abs(i.pitch||-45),o=null;o=n%90==0&&0!=n?90:n%90<=34?34:n%90;let r=Math.abs((o/.01*23e-5).toFixed(2));t.height=r*e;let s=t.toVector3();return s=l(s,{offsetY:Number((r-2.15).toFixed(2))*e}),s}(t,e,n);i(o,{duration:Number(n.duration)||0,heading:Number(n.heading)||0,pitch:Number(n.pitch)||-45,roll:Number(n.roll)||0})}function l(t,{offsetX:i=0,offsetY:n=0,offsetZ:o=0}){if(e){let r=SSmap.Vector3.create(i,n,o),s=e.scene.globe.ellipsoid.eastNorthUpToFixedFrame(t.toCartesian3());return SSmap.Matrix4.multiplyByVector3(s,r)}}return i},EventHandler:function(t,e){function i(t,i){this._canvas=i||Module.qtCanvasElements[0],this._canvas._inputEvents={},this._viewer=e||t}return i.prototype.setInputAction=function(t,e,i){this._canvas.style.cursor="crosshair",void 0===t&&null===t&&console.error("events is required."),void 0===e&&null===e&&console.error("type is required.");var n=this._getInputEventKey(e,i);this._difftype(e,n),this._canvas._inputEvents[n]=t,this._canvas.dbclicknum=0},i.prototype._difftype=function(t,e){var i=this;switch(this._canvas.option={position:{flatposition:null,Cartesian3:null,lonlatlocaltion:null},primitive:{Tilesetinfo:null,entity:null}},t){case 0:case 5:case 9:this._canvas.addEventListener("mousedown",i._ceatemousedownEvent);break;case 1:case 6:case 10:this._canvas.addEventListener("mouseup",i._ceatemouseupEvent);break;case 2:this._canvas.addEventListener("click",i._ceateLeftclickEvent);break;case 3:this._canvas.addEventListener("dblclick",i._ceateLeftdblclickEvent);break;case 7:this._canvas.addEventListener("contextmenu",i._ceateRightclickEvent);break;case 8:this._canvas.addEventListener("contextmenu",i._ceateRightdblclickEvent);break;case 15:this._canvas.addEventListener("mousemove",i._ceatemousemoveEvent);break;case 16:this._canvas.addEventListener("wheel",i._ceatewheelEvent)}},i.prototype._ceateLeftclickEvent=function(t){if(null!=e.scene&&0==t.button){let e=i.prototype._getraycastInfo(t);this._inputEvents[i.prototype.EventType.LEFT_CLICK](e)}},i.prototype._ceateRightclickEvent=function(t){if(null!=e.scene&&2==t.button){let e=i.prototype._getraycastInfo(t);this._inputEvents[i.prototype.EventType.RIGHT_CLICK](e)}},i.prototype._ceateLeftdblclickEvent=function(t){if(null!=e.scene&&0==t.button){let e=i.prototype._getraycastInfo(t);this._inputEvents[i.prototype.EventType.LEFT_DOUBLE_CLICK](e)}},i.prototype._ceateRightdblclickEvent=function(t){if(null!=e.scene&&2==t.button){this.dbclicknum++;let e=this;1==this.dbclicknum&&setTimeout((function(){if(e.dbclicknum>1){let n=i.prototype._getraycastInfo(t);e._inputEvents[i.prototype.EventType.RIGHT_DOUBLE_CLICK](n)}e.dbclicknum=0}),300)}},i.prototype._ceatemousedownEvent=function(t){if(null==e.scene)return;let n=i.prototype._getraycastInfo(t);0==t.button&&this._inputEvents[i.prototype.EventType.LEFT_DOWN](n),1==t.button&&this._inputEvents[i.prototype.EventType.MIDDLE_DOWN](n),2==t.button&&this._inputEvents[i.prototype.EventType.RIGHT_DOWN](n)},i.prototype._ceatemouseupEvent=function(t){if(null==e.scene)return;let n=i.prototype._getraycastInfo(t);0==t.button&&this._inputEvents[i.prototype.EventType.LEFT_UP](n),1==t.button&&this._inputEvents[i.prototype.EventType.MIDDLE_UP](n),2==t.button&&this._inputEvents[i.prototype.EventType.RIGHT_UP](n)},i.prototype._ceatemousemoveEvent=function(t){if(0==t.button){let e=i.prototype._getraycastInfo(t);this._inputEvents[i.prototype.EventType.MOUSE_MOVE](e)}},i.prototype._ceatewheelEvent=function(n){const o=e.scene.mainCamera.transform.cartographic;let r=t.GisUtil.altitudeToZoom(o.height);this._inputEvents[i.prototype.EventType.WHEEL]({height:o.height,zoom:r})},i.prototype._getInputEventKey=function(t,e){var i=t;return null!=e&&(i+="+"+e),i},i.prototype.removeInputAction=function(t){this._canvas.style.cursor="default";var e=this;switch(t){case 0:case 5:case 9:this._canvas.removeEventListener("mousedown",e._ceatemousedownEvent);break;case 1:case 6:case 10:this._canvas.removeEventListener("mouseup",e._ceatemouseupEvent);break;case 2:this._canvas.removeEventListener("click",e._ceateLeftclickEvent);break;case 3:this._canvas.removeEventListener("dblclick",e._ceateLeftdblclickEvent);break;case 7:this._canvas.removeEventListener("contextmenu",e._ceateRightclickEvent);break;case 8:this._canvas.removeEventListener("contextmenu",e._ceateRightdblclickEvent);break;case 15:this._canvas.removeEventListener("mousemove",e._ceatemousemoveEvent);break;case 16:this._canvas.removeEventListener("wheel",e._ceatewheelEvent)}},i.prototype._getTilesetinfo=function(t){var e={};if(t){let i=t.propertyNames(),n=i.size();for(let o=0;o<n;o++){let n=i.get(o),r=t.getProperty(n);e[n]=r}}return e},i.prototype._getraycastInfo=function(n){let o={position:{},primitive:{}};var r=e.scene.mainCamera,s=new t.RaycastHit,a=r.screenPointToRay(n.x,n.y),l=e.scene.raycast(a,s);o.position.flatposition={x:n.x,y:n.y};let h=null;s&&(h=s.point,o.primitive.entity=s.entity),s.delete(),l&&h&&(o.position.Cartesian3=h.toCartesian3(),o.position.lonlatlocaltion=h.toCartesian3().toCartographic().toDegrees());const c=e.scene.getFeatureByMouse();return o.feature=c,o.primitive.Tilesetinfo=i.prototype._getTilesetinfo(c),o},i.prototype.EventType={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,RIGHT_DOUBLE_CLICK:8,MIDDLE_DOWN:9,MIDDLE_UP:10,MOUSE_MOVE:15,WHEEL:16},i},CameraUtil:function(t,e){function i(){this._nowdegrees=0,this._rotatespeed=.01}return Object.defineProperties(i.prototype,{rotatespeed:{get(){return this._rotatespeed},set(t){this._rotatespeed=t}}}),i.prototype.Rotate=function(i){i=i||{},this.frameAction=new t.FrameAction;let n=null;this.rotatespeed=i.speed||.01,i.point?n=t.Cartesian3.fromDegrees(i.point.lon,i.point.lat,i.point.alt).toVector3():"surround"===i.type&&(n=U()),i.refshow&&this._drawPoint("camera",n);let o=this;if(!n)return void console.error("参数报错","point无坐标");let r=n.toCartesian3(),s=e.scene.mainCamera.cameraController(),a=s.heading,l=i.distance||s.positionWC.distance(n);"surround"===i.type&&(l=l<=10?100:l),this.frameAction.onTriggered((function(t){o._nowdegrees+=o.rotatespeed;let e=Math.PI/180*o._nowdegrees+a;s.setView(r,e,s.pitch,s.roll),"surround"===i.type&&s.moveBackward(l)})),e.scene.rootEntity.addComponent(this.frameAction)},i.prototype.removeRotate=function(){this.frameAction&&(this.frameAction.delete(),this.frameAction=null,this._nowdegrees=0,this.bbEntity.delete(),this.bbEntity=null)},i.prototype.tomapMode2D=function(){let t=window.viewer.scene.mainCamera.cameraController();t.enableTilt&&(t.flyToCartographic(t.positionCartographic,1.5,0,-90,0),t.enableTilt=!1)},i.prototype.tomapMode3D=function(){let t=window.viewer.scene.mainCamera.cameraController();t.enableTilt||(t.flyToCartographic(t.positionCartographic,1.5,0,-45,0),t.enableTilt=!0)},i.prototype.toTrueNorth=function(){let t=window.viewer.scene.mainCamera.cameraController();var e=t.positionCartographic,i=t.pitch;t.flyToCartographic(e,1.5,0,180*i/Math.PI,0)},i.prototype._drawPoint=function(e,i){t.BillboardCollection.Instance().removeAll(),this.bbEntity=new t.BillboardEntity,this.bbEntity.position=i,this.bbEntity.url=SSmap.$baseUrl+"/assets/images/circle.png",this.bbEntity.vertical=!0,this.bbEntity.imageWidth=10,this.bbEntity.imageHeight=10,e&&(this.bbEntity.objectName=e),this.bbEntity.setCollection(t.BillboardCollection.Instance())},i},Camera:function(t,e){return function(){new Oe(e)}},CameraRoam:function(t,e){function i(){this._EntityCollection=[],this.roampoint={},this._scene=e.scene,this._mainCamera=this._scene.mainCamera,this._nowindex=1,this._standoffdistance=50,this.isloop=!1,this.Eventtype={roamstart:0,roamstop:1,roampause:2,roamcontinue:3}}return Object.defineProperties(i.prototype,{roaming:{get(){return!!this._frameeventlistenin}},id:{get(){return this._id},set(t){this._id=t}},EntityALLObject:{get(){let t=[];return this._EntityCollection.forEach((e=>{t.push({id:e.id,attr:e.attr})})),t}}}),i.prototype.updateattrById=function(t,e){t&&this._EntityCollection.forEach((i=>{i.id===t&&(i.attr=e,this._showLine(i.Line,e.showrouteLine),this._showsitepoint(i.point,e.showBillboard),this.isloop=null!=e.isloop&&e.isloop)}))},i.prototype.setsitedataBysiteid=function(t,e){if(this._frameeventlistenin)return;let i=this.roampoint[e.id];this.id=e.id;let n=null;for(let o=0;o<i.length;o++){let r=i[o];r.siteid===t&&(i[o]=e,n=this.getsiteBysiteid(r.siteid),n&&(this._removesite(n),this._createPoint(n,e)))}n&&this._createrouteline(n,i)},i.prototype._createPoint=function(e,i){let n=t.Cartesian3.fromDegrees(Number(i.lon),Number(i.lat),Number(i.alt)).toVector3(),o={id:this.id,position:n,text:e.entity.attr.text,Name:e.entity.attr.Name,fontSize:e.entity.attr.fontSize,fontColor:e.entity.attr.fontColor,url:e.entity.attr.url,imageWidth:e.entity.attr.imageWidth,imageHeight:e.entity.attr.imageHeight,scale:e.entity.attr.scale,background:e.entity.attr.background,offset:e.entity.attr.offset,show:null!=e.entity.attr.show&&e.entity.attr.show},r=this._addlabelPoint(o);this._EntityCollection[e.layerindex].point[e.index]=r},i.prototype._createrouteline=function(e,i){this._EntityCollection[e.layerindex].Line.delete();let n=this._EntityCollection[e.layerindex].Line.attr;this._EntityCollection[e.layerindex].Line=null;let o=[];for(let e=0;e<i.length;e++){let n=i[e],r=t.Cartesian3.fromDegrees(Number(n.lon),Number(n.lat),Number(n.alt)).toVector3();o.push(r)}if(o.length>0){var r={id:this.id,width:n.width,alpha:n.alpha,pointArr:o,color:n.color,altitudemethod:n.altitudemethod,name:n.name,show:null!=n.show&&n.show},s=this._addLineEntity(r);this._EntityCollection[e.layerindex].Line=s}},i.prototype.on=function(t,e){switch(t){case 0:this._startroamevent=e;break;case 1:this._stoproamevent=e;break;case 2:this._pauseroamevent=e;break;case 3:this._continueroamevent=e}},i.prototype._removesite=function(t){t&&(t.entity.delete(),this._EntityCollection[t.layerindex].point[t.index]=null)},i.prototype.getsiteBysiteid=function(t,e){if(!(e=e||this.id))return;let i=null;for(let n=0;n<this._EntityCollection.length;n++){let o=this._EntityCollection[n];o.id===e&&o.point.forEach(((e,o)=>{e.objectName!==t||(i={entity:e,index:o,layerindex:n})}))}return i},i.prototype._showLine=function(t,e){if(t.enabled===e)return null;t.enabled=null!=e&&e},i.prototype._showsitepoint=function(t,e){for(let i=0;i<t.length;i++){let n=t[i];if(n.enabled===e)return null;n.enabled=null!=e&&e}},i.prototype.startplay=function(){let e=window.viewer.scene.mainCamera;if(null!=this._frameeventlistenin&&null!=this._frameeventlistenin||this._FramerateEvent)this._FramerateEvent&&(this._continueroamevent&&this._continueroamevent(),this._frameeventlistenin=new t.FrameAction,this._frameeventlistenin.onTriggered(this._FramerateEvent),this._scene.rootEntity.addComponent(this._frameeventlistenin));else{this._startroamevent&&this._startroamevent();let o=this.roampoint[this._id],r=this._computebezierPath(o);if(!r)return null;let s=null;var i=0,n=0;this._frameeventlistenin=new t.FrameAction;let a=this;a._FramerateEvent||(a._FramerateEvent=function(o){if(s=Number(r[a._nowindex-1].speed),null==a._startPoint&&null==a._endPoint){a._startPoint=r[a._nowindex-1],a._endPoint=r[a._nowindex];let e=t.Cartesian3.distance(a._startPoint.position.toCartesian3(),a._endPoint.position.toCartesian3());i=e/s}n+=o;let l=a._endPoint.index&&a._endPoint.index>0?a._endPoint.index:1,h=a._setFlyDuration(n,i);if(h>=l){if(n=0,a._nowindex++,i=0,a._nowindex>=r.length)null!=a._frameeventlistenin&&null!=a._frameeventlistenin&&(a.stopplay(),a.isloop&&a.startplay());else{let t=a._lerpToTime(a._startPoint.position,a._endPoint.position,h).toCartesian3().toCartographic();e.transform.position=t.toVector3()}a._startPoint=null,a._endPoint=null}else{let t=a._lerpToTime(a._startPoint.position,a._endPoint.position,h).toCartesian3().toCartographic();e.transform.position=t.toVector3(),e.transform.lookAt(a._endPoint.position)}}),this._frameeventlistenin.onTriggered(a._FramerateEvent),this._scene.rootEntity.addComponent(this._frameeventlistenin)}},i.prototype.pauseplay=function(){this._frameeventlistenin&&(this._frameeventlistenin.delete(),this._frameeventlistenin=null),this._pauseroamevent&&this._pauseroamevent()},i.prototype.stopplay=function(){this._frameeventlistenin&&(this._nowindex=1,this._frameeventlistenin.delete(),this._frameeventlistenin=null,delete this._FramerateEvent,this._FramerateEvent=null),this._stoproamevent&&this._stoproamevent()},i.prototype.removeRoamById=function(t){(t=t||this._id)&&(this.stopplay(),delete this.roampoint[t],this._EntityCollection.forEach(((e,i)=>{if(e.id===t)return e.Line.delete(),e.point.forEach((t=>{t.delete()})),void this._EntityCollection.splice(i,1)})))},i.prototype.removesiteById=function(t){this.id&&this.roampoint[this.id].forEach(((e,i)=>{if(e.siteid!==t);else{let e=this.getsiteBysiteid(t);e&&(e.entity.delete(),this._EntityCollection[e.layerindex].point.splice(e.index,1),this.roampoint[this.id].splice(i,1),this._createrouteline(e,this.roampoint[this.id]))}}))},i.prototype.getRoamLayerById=function(t){let e=null;return this._EntityCollection.forEach((i=>{i.id===t&&(e=i.attr)})),this.id=t,e},i.prototype.createroamLine=function(e,i){this._drawLineentity&&(this._drawLineentity.delete(),this._drawLineentity=null),e=e||{},this._id=e.id||h(),this.isloop=null!=e.isloop&&e.isloop,this._roampoints=e.points;let n=[];this._polylinepoints=[];let o=[];for(var r=0;r<e.points.length;r++){let i=e.points[r],s=t.Cartesian3.fromDegrees(i[0],i[1],i[2]).toVector3();this._polylinepoints.push(s);let a={id:this._id,position:s,text:"站点"+(r+1),Name:"site"+r,fontSize:10,fontColor:t.Color.fromRgb(255,255,255,255),url:"/assets/images/redpoint.png",imageWidth:16,imageHeight:22,scale:1,background:t.Color.fromRgb(0,0,0,128),offset:t.Cartesian2.create(0,0),show:null!=e.showBillboard&&e.showBillboard},l=this._addlabelPoint(a);n.push(l);let h={id:this._id,siteid:"site"+r,name:"站点"+(r+1),lon:i[0],lat:i[1],alt:i[2]};e.points.length-1!=r&&(h.speed=100),o.push(h)}this.roampoint[this._id]=o;var s={id:this._id,width:5,alpha:1,pointArr:this._polylinepoints,color:t.Color.fromRgb(211,25,222,255),altitudemethod:t.AltitudeMethod.Absolute,name:"line-roam",show:null!=e.showrouteLine&&e.showrouteLine},a=this._addLineEntity(s);let l={pointLists:o,name:e.name,layerid:this._id,routeremarks:e.routeremarks||"",isloop:null!=e.isloop&&e.isloop,showrouteLine:null!=e.showrouteLine&&e.showrouteLine,showBillboard:null!=e.showBillboard&&e.showBillboard};this._EntityCollection.push({id:this._id,Line:a,point:n,attr:l}),i&&i(l)},i.prototype._addlabelPoint=function(e){var i=new t.Label3D;return i.position=e.position,""!=e.text&&null!=e.text&&(i.text=e.text),i.fontColor=e.fontColor,i.fontSize=e.fontSize,e.url&&(i.url=SSmap.$baseUrl+e.url),e.imageWidth&&(i.imageWidth=e.imageWidth),e.imageHeight&&(i.imageHeight=e.imageHeight),e.background&&(i.background=e.background),e.strokeColor&&(i.strokeColor=e.strokeColor),e.altitude?(i.setAltitude(e.altitude),i.setAltitudeMethod(t.AltitudeMethod.Absolute)):i.setAltitudeMethod(t.AltitudeMethod.OnTerrain),e.offset&&(i.offset=e.offset),i.enabled=e.show,e.scaleByDistance&&i.setScaleByDistance(e.scaleByDistance),e.translucencyByDistance&&i.setTranslucencyByDistance(e.translucencyByDistance),i.scale=null==e.scale?1:e.scale,e.Name&&(i.objectName=e.Name||""),i.setLineToGround(!1),i.addProperty("id",e.name||"label3d"),i.addProperty("attr",JSON.stringify(e)),i.setCollection(t.BillboardCollection.Instance()),i.attr=e,i},i.prototype._addLineEntity=function(e){var i=new t.Polyline3D;i.setWidth(e.width),i.alpha=e.alpha>=1?.99:e.alpha;for(var n=0;n<e.pointArr.length;n++)i.addPoint(e.pointArr[n]);return i.color=e.color,i.depthTest=null==e.depthTest||e.depthTest,e.altitudemethod&&i.setAltitudeMethod(e.altitudemethod),e.altitude&&i.setAltitude(e.altitude),i.setMinDistance(5),i.setGlowMaterial(null!=e.glow&&e.glow),e.imgurl&&(i.setImageUrl(SSmap.$baseUrl+e.imgurl),i.setRepeat(e.repeat||20)),e.flowanim&&(i.animationRun=e.flowanim,i.animationTimer=e.flowanimspeed||3e3),i.name=e.name,e.id&&(i.id=e.id,i.addProperty("id",e.id),i.addProperty("name",e.name)),i.enabled=e.show,i.draw(),i.end(),i.attr=e,i},i.prototype.removeEntity=function(){for(var t=0;t<this._EntityCollection.length;t++){let e=this._EntityCollection[t];e&&e.delete(),this._EntityCollection.splice(t,1),t--}},i.prototype.drawLineroute=function(e){this._drawLineentity&&this._drawLineentity.delete();let i=[];e.forEach((e=>{let n=t.Cartesian3.fromDegrees(e[0],e[1],e[2]).toVector3();i.push(n)}));var n={id:this._id,width:5,alpha:1,pointArr:i,color:t.Color.fromRgb(211,25,222,255),altitudemethod:t.AltitudeMethod.Absolute,name:"line-roam",show:!0};this._drawLineentity=this._addLineEntity(n)},i.prototype._setFlyDuration=function(t,e){let i=t/e;return i=Math.min(i,1),i},i.prototype._lerpToTime=function(e,i,n){return t.Vector3.lerp(e,i,n)},i.prototype._computebezierPath=function(e){let i=e,n=i.length;if(n<3){let e=[];for(let o=0;o<n;o++){let n=t.Cartesian3.fromDegrees(Number(i[o].lon),Number(i[o].lat),Number(i[o].alt)).toVector3();e.push({position:n,speed:Number(i[o].speed),name:i[o].name,siteid:i[o].siteid})}return e}let o=this._OneToTwoextendpoint(e),r=this._createBeziercurveroute(o),s=[];for(let t=0;t<r.length;t++){let e=r[t],n=i[e.indexline];n.speed&&s.push({position:e.position,speed:Number(n.speed),name:n.name,siteid:n.siteid,index:e.index})}let a=i[i.length-1];return s.push({position:t.Cartesian3.fromDegrees(Number(a.lon),Number(a.lat),Number(a.alt)).toVector3(),name:a.name,siteid:a.siteid}),s},i.prototype._OneToTwoextendpoint=function(e){let i=[];for(let n=0;n<e.length-1;n++){let o=e[n],r=e[n+1],s=t.Cartesian3.fromDegrees(Number(o.lon),Number(o.lat),Number(o.alt)).toVector3(),a=t.Cartesian3.fromDegrees(Number(r.lon),Number(r.lat),Number(r.alt)).toVector3(),l=this._createstandoffdistance(s,a,!0),h=this._createstandoffdistance(s,a,!1);i.push(s),i.push(l),i.push(h)}return i.pop(),i},i.prototype._createstandoffdistance=function(e,i,n){let o=e.distanceToPoint(i),r=t.Vector3.create(i.x-e.x,i.y-e.y,i.z-e.z).normalize(),s=this._standoffdistance;s>o&&(s=o/2),r=t.Vector3.create(r.x*s,r.y*s,r.z*s);let a=null;return a=n?t.Vector3.create(e.x+r.x,e.y+r.y,e.z+r.z):t.Vector3.create(i.x-r.x,i.y-r.y,i.z-r.z),a},i.prototype._createstandoffdistance_des=function(e,i){let n=t.Cartesian3.distance(e.toCartesian3(),i.toCartesian3()),o=t.Vector3.subtract(i,e);o=o.normalize();let r=this._standoffdistance/n,s=t.Vector3.multiplyByScalar(o,r);return t.Vector3.add(e,s)},i.prototype._createBeziercurveroute=function(t){let e=[],i=t.length/3;e.push({position:t[0],indexline:0}),e.push({position:t[1],indexline:0});let n=0;for(let o=1;o<i;o++){let i=3*o,r=t[i-1],s=t[i],a=t[i+1],l=this._getBezierList(r,s,a,21),h=l.length;for(let t=0;t<h;t++){Math.floor(h/2+1)==t&&n++;let i=t/(h-1),o={position:l[t],indexline:n,index:i};e.push(o)}}return e.push({position:t[t.length-1],indexline:n}),e},i.prototype._getBezierList=function(t,e,i,n){let o=[];for(let r=1;r<=n;r++){let s=r/Number(n),a=this._calculateCubicBezierPoint(t,e,i,s);o.push(a)}return o},i.prototype._calculateCubicBezierPoint=function(e,i,n,o){let r=1-o,s=o*o,a=r*r,l=t.Vector3.create(2*r*o*i.x,2*r*o*i.y,2*r*o*i.z),h=t.Vector3.create(s*n.x,s*n.y,s*n.z),c=t.Vector3.create(a*e.x,a*e.y,a*e.z);return c=t.Vector3.create(c.x+l.x,c.y+l.y,c.z+l.z),c=t.Vector3.create(c.x+h.x,c.y+h.y,c.z+h.z),c},i},analyse:{Skyline:function(t,e){let i=null;function n(t){if(i&&!t.toImage)return i;{let e={toImage:"",width:1,color:"#FF0000"};this._options=s(e,t),this.create(this._options),i=this}}return n.prototype.create=function(e){let i=e.width,n=e.color;n=l(n),n=t.Color.fromRgb(n.r,n.g,n.b,255),this._options.toImage?this.renderImage(i,n):this.renderPoster(i,n)},n.prototype.renderPoster=function(i,n){let o=new t.Material;o.shaderProgram=t.ShaderProgram.createViewportQuadShader("#version 300 es\n    precision highp float;\n    precision highp sampler2D;\n\n    layout(location = 0) out vec4 FragColor;\n\n    in vec2 v_textureCoordinates;\n\n    uniform sampler2D colorTexture;\n    uniform sampler2D depthTexture;\n    uniform float u_width;\n    uniform vec4 u_color;\n    const float MAX_DEPTH_VALUE = 16777216.0;\n\n    void main()\n    {\n        ivec2 uv = ivec2(gl_FragCoord.xy);\n            \n        // const float MAX_DEPTH_VALUE = 16777216.0;\n        float fMinDepth = MAX_DEPTH_VALUE;\n        float fMaxDepth = 0.0;\n\n        ivec2 texSize = ivec2(textureSize(depthTexture, 0).xy);\n\n        float samples = ceil((u_width + 1.0) / 2.0);\n\n        for (float y = -samples; y <= samples; ++y) \n        {\n            for (float x = -samples; x <= samples; ++x) \n            {\n                ivec2 st = clamp(uv+ivec2(x, y), ivec2(0), texSize-1);\n                float fDepth = texelFetch(depthTexture, st, 0).x;\n                fMinDepth = min(fMinDepth, fDepth);\n                fMaxDepth = max(fMaxDepth, fDepth);\n            }\n        }\n\n        bool isEdge = false;//uv.x == 0 || uv.x == texSize.x-1 || uv.y == 0 || uv.y == texSize.y-1;\n\n        float fEdge = float(!isEdge && fMinDepth < MAX_DEPTH_VALUE && fMaxDepth == MAX_DEPTH_VALUE);\n        \n        vec4 color = texture(colorTexture, v_textureCoordinates);\n        FragColor = vec4(mix(color.rgb, u_color.rgb, fEdge), 1.0);\n    }\n"),o.setParameterFloat("u_width",i),o.setParameterColor("u_color",n);let r=new t.PostProcess;r.material=o,e.renderSystem.addPostProcess(r),this.material=o,this.postProcess=r},n.prototype.renderImage=function(i,n){e.renderSystem.renderSkyline(920,200,i,n).then((e=>{let i=t.ByteArray.fromPtr(e).data(),n=new Uint8Array(i),o=new Blob([n],{type:"image/png"}),r=URL.createObjectURL(o);this._options.toImage.call(this,r)}))},n.prototype.remove=function(){this._options.toImage||(this.material.delete(),this.postProcess.delete())},Object.defineProperties(n.prototype,{color:{get(){return this._options.color},set(e){this._options.color=e;let i=l(e);this.material.setParameterColor("u_color",t.Color.fromRgb(i.r,i.g,i.b,255))}},width:{get(){return this._options.width},set(t){this._options.width=t,this.material.setParameterFloat("u_width",t)}}}),n},Sightline:function(t,e){function n(t){this._options=s({offetHeight:1.7},t),K(this),this.initData()}return tt(n),n.prototype.initData=function(){this.cache={points:[],helperPoints:[],labelList:[],list:[]},this.draw()},n.prototype.draw=function(){let t=this,e=this.cache,n=0,o=new i.graphic.Polyline({style:{color:"#0099ff"}}),r=o.tooltip;r.innerText="单击开始绘制",o.$on("step",(function(i,o){r.innerText="单击开始分析",t.drawClickPoint("sightline",o);let s=t._options.offsetHeight;if(0==n&&0!=s){let t=o.toCartographic();t.height+=s,o=t.toVector3()}if(e.points.push(o),2==++n){this.end(),this.remove();let i=[" 观察位置 "," 目标点 "];for(let n=0;n<i.length;n++){let o=i[n],r=t.drawLabel3d({name:"sightline",position:e.points[n],text:o});e.labelList.push(r)}t.analyse()}}))},n.prototype.drawClickPoint=function(e,n,o){let r=this.cache,s=new t.BillboardEntity;s.position=n,s.url=i.$baseUrl+"/assets/images/circle.png",s.vertical=!0,s.imageWidth=10,s.imageHeight=10,e&&(s.objectName=e,o?r.helperPoints.splice(o,0,s):r.helperPoints.push(s)),null==r.billboardCollection&&(r.billboardCollection=new t.BillboardCollection,r.list.push(r.billboardCollection)),s.setCollection(r.billboardCollection)},n.prototype.drawLabel3d=function({name:e,position:i,url:n,text:o,imageWidth:r,imageHeight:s,fontSize:a,color:l,background:h}){let c=this.cache,u=new t.Label3D;if(u.name=e,u.position=i,u.text=o,u.fontSize=a||11,u.fontColor=l||t.Color.fromRgb(0,0,0,255),u.background=h||t.Color.fromRgb(255,255,255,255),n&&(u.url=n,u.imageWidth=r,u.imageHeight=s),null==c.billboardCollection){let e=new t.BillboardCollection;c.billboardCollection=e,c.list.push(c.billboardCollection)}return u.setCollection(c.billboardCollection),u},n.prototype.analyse=function(){let n=this.cache,o=n.points[0],r=n.points[1],s=t.Vector3.subtract(r,o);s=s.normalize();let a=t.Vector3.multiplyByScalar(s,.1),l=t.Vector3.add(o,a),h=t.Ray.create(l,s),c=new t.RaycastHit;if(e.scene.raycast(h,c)){let t=c.point,e=new i.graphic.Polyline({positions:[o,t],style:{color:"#00FF00"}}),s=new i.graphic.Polyline({positions:[t,r],style:{color:"#FF0000"}});n.list.push(e.instance,s.instance)}c.delete()},n.prototype.remove=function(){let t=this.cache;[...t.helperPoints,...t.labelList,...t.list].forEach((t=>{t.delete()})),this.cache={distance:0,points:[],helperPoints:[],labelList:[],list:[]}},n},ClipBox:function(t,e){function n(t){this.cache={list:[]},this._options=s({debugBox:!0},t),t.direction&&(this._position=JSON.stringify(t.position),this.initData(this._options)),this.instance=this.create(this._options)}return n.prototype.initData=function(e){let i=t.Cartographic.fromDegrees(e.position.longitude,e.position.latitude,e.position.height).toVector3(),n=null;switch(e.distance=e.distance||.001,e.direction){case"top":e.position.height+=e.radius,e.position.height-=e.distance/2,e.size={x:e.radius,y:e.radius,z:e.distance/2};break;case"bottom":e.position.height-=e.radius,e.position.height+=e.distance/2,e.size={x:e.radius,y:e.radius,z:e.distance/2};break;case"east":i=W(i,{offsetX:e.radius-e.distance/2}),n=Z(i),e.position={longitude:n.longitude,latitude:n.latitude,height:n.height},e.size={x:e.distance/2,y:e.radius,z:e.radius};break;case"west":i=W(i,{offsetX:-e.radius+e.distance/2}),n=Z(i),e.position={longitude:n.longitude,latitude:n.latitude,height:n.height},e.size={x:e.distance/2,y:e.radius,z:e.radius};break;case"north":i=W(i,{offsetY:e.radius-e.distance/2}),n=Z(i),e.position={longitude:n.longitude,latitude:n.latitude,height:n.height},e.size={x:e.radius,y:e.distance/2,z:e.radius};break;case"south":i=W(i,{offsetY:-e.radius+e.distance/2}),n=Z(i),e.position={longitude:n.longitude,latitude:n.latitude,height:n.height},e.size={x:e.radius,y:e.distance/2,z:e.radius}}},n.prototype.create=function(i){let n=e.scene,o=t.Cartographic.fromDegrees(i.position.longitude,i.position.latitude,i.position.height),r=i.size,s=new t.ClipVolume;s.shape=t.ClipVolumeShape.Cube,s.clipFlag=t.ClipVolumeFlag.ClipScene,s.size=t.Vector3.create(r.x,r.y,r.z),s.showDebugVolume=!1,s.objectName="clipVolume";let a=new t.Entity;a.transform.cartographic=o;let l,h=new t.Entity;return h.parent=a,i.rotation&&(l=t.Quaternion.fromEulerAngles(i.rotation.x||0,i.rotation.y||0,i.rotation.z||0),h.transform.rotation=l),h.addComponent(s),n.addEntity(a),this._childEntity=h,this._entity=a,i.debugBox&&this.drawDebugBox(o,r,l),s},n.prototype.transform=function(e){if(this._options=s(this._options,e),e.position){let i=t.Cartographic.fromDegrees(e.position.longitude,e.position.latitude,e.position.height);this._entity.transform.cartographic=i}if(e.rotation){let i;i=t.Quaternion.fromEulerAngles(e.rotation.x||0,e.rotation.y||0,e.rotation.z||0),this._childEntity.transform.rotation=i}if(e.size&&(this.instance.size=t.Vector3.create(e.size.x,e.size.y,e.size.z)),this._options.debugBox){let e=this._options.position;e=t.Cartographic.fromDegrees(e.longitude,e.latitude,e.height);let i=this._options.rotation;i&&(i=t.Quaternion.fromEulerAngles(i.x||0,i.y||0,i.z||0)),this.removeDebugBox(),this.drawDebugBox(e,this._options.size,i)}},n.prototype.drawDebugBox=function(t,e,n){let o=t.toVector3(),r=W(o,{offsetX:-e.x,offsetY:e.y,offsetZ:e.z},n),s=W(o,{offsetX:e.x,offsetY:e.y,offsetZ:e.z},n),a=W(o,{offsetX:e.x,offsetY:-e.y,offsetZ:e.z},n),l=W(o,{offsetX:-e.x,offsetY:-e.y,offsetZ:e.z},n),h=W(o,{offsetX:-e.x,offsetY:e.y,offsetZ:-e.z},n),c=W(o,{offsetX:e.x,offsetY:e.y,offsetZ:-e.z},n),u=W(o,{offsetX:e.x,offsetY:-e.y,offsetZ:-e.z},n),p=W(o,{offsetX:-e.x,offsetY:-e.y,offsetZ:-e.z},n);if(this._options.direction){let t=[];switch(this._options.direction){case"top":t=[h,c,u,p];break;case"bottom":t=[r,s,a,l];break;case"east":t=[r,l,p,h];break;case"west":t=[s,a,u,c];break;case"north":t=[l,a,u,p];break;case"south":t=[r,s,c,h]}this.drawPolygon3d(t)}else{let t=new i.graphic.Polyline({positions:[r,s,a,l],closePath:!0,style:{color:"#00FF00",lineWidth:1}},n),e=new i.graphic.Polyline({positions:[h,c,u,p],closePath:!0,style:{color:"#00FF00",lineWidth:1}},n),o=new i.graphic.Polyline({positions:[r,h],style:{color:"#00FF00",lineWidth:1}},n),d=new i.graphic.Polyline({positions:[s,c],style:{color:"#00FF00",lineWidth:1}},n),y=new i.graphic.Polyline({positions:[a,u,a],style:{color:"#00FF00",lineWidth:1}},n),f=new i.graphic.Polyline({positions:[l,p],style:{color:"#00FF00",lineWidth:1}},n);this.cache.list.push(t,e,o,d,y,f)}},n.prototype.drawPolygon3d=function(e){let i=this.cache;i.polygon3d&&(i.polygon3d.delete(),i.polygon3d=null);let n=new t.Polygon3D;n.color=t.Color.fromRgb(0,125,255,255),n.alpha=.7,n.fillAlpha=.1,n.setFillColor(t.Color.fromRgb(0,125,255,255)),n.setAltitudeMethod(t.AltitudeMethod.Absolute),i.polygon3d=n,e.forEach((e=>{let i=t.Vector3.create(e.x,e.y,e.z);n.addPoint(i)})),n.draw(),n.end()},n.prototype.removeDebugBox=function(){this.cache.list.forEach((t=>{t.remove()})),this.cache.polygon3d&&this.cache.polygon3d.delete(),this.cache={list:[]}},n.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null),this._entity&&(this._entity.delete(),this._entity=null),this._options.debugBox&&this.removeDebugBox()},Object.defineProperties(n.prototype,{distance:{get(){return this._options.distance.z},set(t){this._options.direction&&(this._options.position=JSON.parse(this._position),this._options.distance=t,this.initData(this._options),this.transform({position:this._options.position,size:this._options.size}))}},debugBox:{get(){return this._options.debugBox},set(e){if(this._options.debugBox=e,e){let e=this._options.position;e=t.Cartographic.fromDegrees(e.longitude,e.latitude,e.height);let i=this._options.rotation;i&&(i=t.Quaternion.fromEulerAngles(i.x||0,i.y||0,i.z||0)),this.drawDebugBox(e,this._options.size,i)}else this.removeDebugBox()}}}),n},Flood:function(t,e){function n(t){this._options=s({type:"circle",height:0,minHeight:0,maxHeight:0,levelMeters:20,speed:5,color:"#007BE6"},t),K(this),this.initData()}return tt(n),n.prototype.initData=function(){this._polygon=this.drawPolygon()},n.prototype.drawPolygon=function(){let t=this,e=new i.graphic.Polygon({type:this._options.type,style:{mode:"OnTerrain",color:this._options.color,alpha:.1,fillAlpha:.5}});return e.$on("end",(function(){setTimeout((()=>{t.$emit("calc-start")}),0),t.getHeightRange(this.cache.points)})),e},n.prototype.drawVolume=function(t){return new i.graphic.ExtrudeEntity({positions:t,style:{height:this.height,color:"#053966",baseHeight:0,waterShader:!0,opacity:.35}})},n.prototype.getHeightRange=function(e){let n=this.getBBox(e),o=Math.PI/180,r=n[1]-n[0],s=n[3]-n[2],a=s*o/1.57891e-7;let l=(h=s*o,r*o/1.56785e-7*Math.cos(h));var h;let c=parseInt(a/this._options.levelMeters),u=parseInt(l/this._options.levelMeters),p=[];for(let e=0;e<u;e++)for(let i=0;i<c;i++){let o=n[0]+r/u*e,a=n[2]+s/c*i,l=t.Cartographic.fromDegrees(o,a,0);l=l.toVector3();let h={x:l.x,y:l.y,z:l.z};p.push(h)}e=e.map((t=>({x:t.x,y:t.y,z:t.z})));let d=new t.PointVector,y=new Worker(i.$baseUrl+"/assets/range-worker.js",{});y.postMessage({rectPoints:p,points:e}),y.onmessage=e=>{e.data.points.forEach((e=>{e=t.Vector3.create(e.x,e.y,e.z),d.push_back(e)})),t.GisUtil.calculateMinMaxMean(d,-200,2e3,!1).then(((t,e)=>{let i=Number(t.toFixed(1)),n=Number(e.toFixed(1));this._options.minHeight=i,this._options.maxHeight=n,this.$emit("calc-end",i,n)})),d.delete()}},n.prototype.getBBox=function(t){let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return t.forEach((t=>{let r=t.toCartographic().toDegrees();e=Math.min(e,r.longitude),i=Math.max(i,r.longitude),n=Math.min(n,r.latitude),o=Math.max(o,r.latitude)})),[e,i,n,o]},n.prototype.analyse=function(t=!0){let e=this._polygon;e&&this.height<this.maxHeight&&(this._points||(this._points=e.cache.points),e.remove(),e=this.drawVolume(this._points),this._polygon=e,t&&this.animate())},n.prototype.animate=function(){if(this._animating=!0,!this._frameAction){let i=e.scene,n=new t.FrameAction;n.onTriggered((t=>{if(console.log("animate"),!this._animating)return void this.$emit("animating","pause");let e=t*this._options.speed;this._options.height+=e,this._polygon.height=this._options.height,this._options.height>=this._options.maxHeight?(this._animating=!1,this.$emit("animating","end"),n.delete(),this._frameAction=null):this.$emit("animating","running")})),i.rootEntity.addComponent(n),this._frameAction=n}},n.prototype.remove=function(){this._polygon&&(this._polygon.remove(),this._polygon=null,this._points=null,this._frameAction&&(this._frameAction.delete(),this._frameAction=null,this._animating=!1))},Object.defineProperties(n.prototype,{minHeight:{get(){return this._options.minHeight},set(t){this._options.minHeight=t}},maxHeight:{get(){return this._options.maxHeight},set(t){this._options.maxHeight=t}},height:{get(){return this._options.height},set(t){let e=this._options.minHeight,i=this._options.maxHeight;this._options.height=Math.max(e,Math.min(t,i)),this._polygon&&!this.animating&&(this._polygon.height=this._options.height)}},speed:{get(){return this._options.speed},set(t){this._options.speed=t}},animating:{get(){return this._animating},set(t){this._animating=t}}}),n},Buffer:function(t,e){function n(t){if(this.turf=i.turf||window.turf,!this.turf)return void console.error("此实例依赖第三方库turf，请先引入turf.js");this._options=s({type:"point",style:{color:"#FFFF00",bufferColor:"#FF0000",bufferAlpha:.5,radius:50,steps:89,units:"kilometers"}},t),this.cache={points:[],list:[]},K(this),this.init(this._options)}return tt(n),n.prototype.init=function(t){let e=this,n=this.cache,o=t.positions;if(o){let t=j(o);switch(this._options.type){case"point":this.drawPointBuffer(t[0]);break;case"line":let e=new i.graphic.Polyline({positions:o,style:{color:"#FFFF00"}});this.drawLineBuffer(t),n.list.push(e);break;case"polygon":let r=new i.graphic.Polygon({positions:o,style:{color:"#FFFF00",mode:"OnTerrain",fillAlpha:.5}});this.drawPolygonBuffer(t),n.list.push(r)}}else switch(this._options.type){case"point":Y((t=>{this.drawPointBuffer(t)}));break;case"line":let t=new i.graphic.Polyline({style:{color:"#FFFF00"}});t.$on("end",(function(){e.drawLineBuffer(this.cache.points)})),n.list.push(t);break;case"polygon":let o=new i.graphic.Polygon({style:{color:"#FFFF00",mode:"OnTerrain",fillAlpha:.5}});o.$on("end",(function(){let t=this.cache.points;e.drawPolygonBuffer([...t,t[0]])})),n.list.push(o)}},n.prototype.drawPointBuffer=function(t){let e=this._options.style,n=this.cache,o=t.toCartographic().toDegrees(),r=this.turf;t=r.point([o.longitude,o.latitude]);let s=r.buffer(t,e.radius/1e3,{units:e.units,steps:e.steps}),a=s.geometry.coordinates[0],l=new i.graphic.Polygon({positions:a,style:{mode:"OnTerrain",color:e.bufferColor,fillAlpha:e.bufferAlpha}});s=r.buffer(t,e.radius/2e4,{units:e.units,steps:e.steps}),a=s.geometry.coordinates[0];let h=new i.graphic.Polygon({positions:a,style:{mode:"OnTerrain",color:e.color}});n.list.push(l,h),this.$emit("end","point",t)},n.prototype.drawLineBuffer=function(t){let e=this._options.style,n=this.cache,o=this.turf;t=$(t),t=o.lineString(t),t=o.buffer(t,e.radius/1e3,{units:e.units,steps:e.steps}).geometry.coordinates[0];let r=new i.graphic.Polygon({positions:t,style:{color:e.bufferColor,fillAlpha:e.bufferAlpha,mode:"OnTerrain"}});n.list.push(r)},n.prototype.drawPolygonBuffer=function(t){let e=this._options.style,n=this.cache,o=this.turf;t=$(t),t=o.polygon([t]),t=o.buffer(t,e.radius/1e3,{units:e.units,steps:e.steps}).geometry.coordinates[0];let r=new i.graphic.Polygon({positions:t,style:{color:e.bufferColor,fillAlpha:e.bufferAlpha,mode:"OnTerrain"}});n.list.push(r)},n.prototype.remove=function(){let t=this.cache;t.list.length&&(t.list.forEach((t=>{t.remove()})),t={points:[],list:[]})},n},Topology:function(t,e){function n(t){if(this.turf=i.turf||window.turf,!this.turf)return void console.error("此实例依赖第三方库turf，请先引入turf.js");this._options=s({type:"intersect",style:{}},t),this.cache={points:[],list:[]},K(this),this.init(this._options)}return tt(n),n.prototype.init=function(t){let e=this.cache,n=t.polygonA,o=t.polygonB;n&&o?(n=new i.graphic.Polygon({positions:n,style:{color:"#FF0000",mode:"OnTerrain",fillAlpha:.5}}),o=new i.graphic.Polygon({positions:o,style:{color:"#0000FF",mode:"OnTerrain",fillAlpha:.5}}),e.list.push(n,o),this.calc(n,o)):this.drawPolygon("first")},n.prototype.drawPolygon=function(t){let e=this,n=this.cache,o=new i.graphic.Polygon({style:{color:"first"==t?"#FF0000":"#0000FF",mode:"OnTerrain",fillAlpha:.5}});n.list.push(o),o.$on("end",(function(){let i=this.cache.points;i=$(i),"first"==t?e.$emit("first-end",i):(e.$emit("second-end",i),e.calc(...n.list))}))},n.prototype.calc=function(t,e){let n=this.cache,o=this._options.type,r=this.turf,s=$(t.cache.points);s=r.polygon([[...s,s[0]]]);let a=$(e.cache.points);a=r.polygon([[...a,a[0]]]);let l=null,h=null;switch(o){case"intersect":h=r.intersect(s,a);break;case"union":h=r.union(s,a);break;case"difference":h=r.difference(s,a)}if(h){let t=h.geometry.coordinates;t=1==t.length?[t]:t,t.forEach((t=>{l=new i.graphic.Polygon({positions:t[0],style:{borderWidth:5,borderColor:"#FFFFFF",color:"#00FF00",mode:"OnTerrain",fillAlpha:.9}}),n.list.push(l)}))}this.$emit("end",h)},n.prototype.remove=function(){let t=this.cache;t.list.length&&(t.list.forEach((t=>{t.remove()})),t={points:[],list:[]})},n},Slope:function(t,e){function n(t){this._options=s({type:"rect",style:{color:"#007BE6",fillAlpha:.5}},t),this.instance=null,K(this),this.initData(this._options)}return tt(n),n.prototype.initData=function(t){let e=t.positions;if(e){let t=j(e);this.analyse(t)}else this.drawPolygon()},n.prototype.drawPolygon=function(){let t=this,e=this._options.style,n=new i.graphic.Polygon({type:this._options.type,style:{mode:"OnTerrain",color:e.color,alpha:e.fillAlpha,fillAlpha:e.fillAlpha}});return n.$on("end",(function(){t.analyse(this.cache.points),n.remove()})),n},n.prototype.analyse=function(e){let i=new t.SlopeAndAspect;e.forEach((t=>{i.add(t)})),i.create(),this.instance=i,this.$emit("end",this._options.type)},n.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},n},LimitHeight:function(t,e){function n(t){this._options=s({type:"rect",positions:null,style:{color:"#ff0000",fillAlpha:.7,height:.1,bottomHeight:1e3}},t),this.instance=null,K(this),this.initData(this._options)}return tt(n),n.prototype.initData=function(t){let e=t.positions;if(e){let t=j(e);this.analyse(t)}else this.drawPolygon()},n.prototype.drawPolygon=function(){let t=this,e=new i.graphic.Polygon({type:this._options.type,style:{mode:"OnTerrain",color:"#ffff00",alpha:.3,fillAlpha:.3}});e.$on("end",(function(){e.remove(),t.analyse(this.cache.points)}))},n.prototype.analyse=function(t){let e=this._options.style;this.instance=new i.graphic.Polygon({type:this._options.type,positions:t,style:{mode:"OnTerrain",color:e.color,alpha:e.fillAlpha,fillAlpha:e.fillAlpha,limitHeight:e.height,bottomHeight:e.bottomHeight}})},n.prototype.remove=function(){this.instance&&(this.instance.remove(),this.instance=null)},Object.defineProperties(n.prototype,{bottomHeight:{get(){return this.instance.instance.height()},set(t){this.instance.instance.setHeight(t)}},height:{get(){return this.instance.instance.limitHeight()},set(t){this.instance.instance.setLimitHeight(t)}}}),n},ViewShed:function(t,e){function i(t){this._options=s({position:null,endPoint:null,showDebugFrame:!1,style:{visibleColor:"#00ff00",invisibleColor:"#ff0000",horizontalAngle:120,verticalAngle:90,offsetHeight:1.6}},t),this.instance=null,K(this),this.initData(this._options)}return tt(i),i.prototype.initData=function(t){this.cache={distance:0,points:[],list:[]};let e=t.position,i=t.endPoint;e&&i?(e=j([e]),i=j([i]),this.instance=this.analyse(e[0],i[0]),setTimeout((()=>{this.$emit("end")}),0)):this.initEvent()},i.prototype.initEvent=function(){let t=this.cache,i=e.canvasEl,n=this.mousedownEvent.bind(this),o=this.mousemoveEvent.bind(this);t.mousedown=n,t.mousemove=o,i.style.cursor="crosshair";this.initTooltip("左键拾取"),i.addEventListener("mousedown",n),document.addEventListener("mousemove",o)},i.prototype.mousedownEvent=function(i){let n=this.cache;if(0==i.button){n.drawing=!0;let o=i.x,r=i.y,s=e.scene,a=s.mainCamera.screenPointToRay(o,r),l=new t.RaycastHit;if(s.raycast(a,l)){let t=l.point;if(n.points.push(t),1==n.points.length&&(this.tooltip.innerText="左键分析"),2==n.points.length)return void this.removeMouseEvent()}l.delete()}},i.prototype.mousemoveEvent=function(i){let n=this.cache,o=i.x,r=i.y,s=this.tooltip;if(s.style.display="block",s.style.left=o+5+"px",s.style.top=r+5+"px",0==n.points.length)return;let a=e.scene,l=a.mainCamera.screenPointToRay(o,r),h=new t.RaycastHit;if(a.raycast(l,h)){let t=h.point;n.entity&&n.entity.delete();let e=this.analyse(n.points[0],t);n.entity=e,this.instance=e}h.delete()},i.prototype.removeMouseEvent=function(){let t=this.cache,i=e.canvasEl;t.mousedown&&(i.removeEventListener("mousedown",t.mousedown),t.mousedown=null),t.mousemove&&(document.removeEventListener("mousemove",t.mousemove),t.mousemove=null),i.style.cursor="default",t.drawing=!1,this.removeTooltip(),this.$emit("end")},i.prototype.end=function(){this.removeMouseEvent()},i.prototype.initTooltip=function(t){let e=document.createElement("div");e.innerText=t,e.style.cssText="\n            position: absolute;\n            left: 0;\n            top: 0;\n            display: none;\n            padding: 3px 6px;\n            color: #fff;\n            background-color: rgba(20, 20, 20, 0.6);\n            font-size: 12px;\n        ",document.body.appendChild(e),this.tooltip=e},i.prototype.removeTooltip=function(){this.tooltip&&(document.body.removeChild(this.tooltip),this.tooltip=null)},i.prototype.analyse=function(i,n){let o=e.scene,r=new t.Viewshed;this.renderer=r;let s=this._options.style,a=l(s.visibleColor),h=l(s.invisibleColor);s.offsetHeight&&(i=W(i,{offsetZ:s.offsetHeight})),r.start=i,r.end=n,r.verticalAngle=s.verticalAngle,r.horizontalAngle=s.horizontalAngle,r.visibleColor=t.Color.fromRgb(a.r,a.g,a.b,255),r.invisibleColor=t.Color.fromRgb(h.r,h.g,h.b,255);let c=t.Vector3.subtract(n,i);r.radius=c.length(),r.showDebugFrame=this._options.showDebugFrame;let u=new t.Entity;return u.name="viewshed",u.addComponent(r),o.addEntity(u),u},i.prototype.remove=function(){this.instance&&(this.instance.delete(),this.cache.viewshed=null,this.instance=null)},Object.defineProperties(i.prototype,{radius:{get(){return this.renderer.radius},set(t){this.renderer.radius=t}},horizontalAngle:{get(){return this.renderer.horizontalAngle},set(t){this.renderer.horizontalAngle=t}},verticalAngle:{get(){return this.renderer.verticalAngle},set(t){this.renderer.verticalAngle=t}},showDebugFrame:{get(){return this.renderer.showDebugFrame},set(t){this.renderer.showDebugFrame=t}}}),i},CutFillVolume:function(t,e){function n(t){this._options=s({type:"rect",style:{baseHeight:35,color:"#00ffff",lineColor:"#00ff00",fillColor:"#00ffff",cutColor:"#00ff00",alpha:.35}},t),this.instance=null,K(this),this.initData(this._options)}return tt(n),n.prototype.initData=function(t){if(t.positions){let e=j(t.positions);this.analyse(e)}else this.drawPolygon()},n.prototype.drawPolygon=function(){let t=this,e=new i.graphic.Polygon({type:this._options.type,style:{mode:"OnTerrain",color:this._options.style.color,alpha:.3,fillAlpha:.3}});return e.$on("end",(function(){e.remove(),t.analyse(this.cache.points)})),e},n.prototype.drawFillVolume=function(t,e){let i=this._options.style;return B({points:t,height:e,color:i.fillColor,onTerrian:!0,opacity:i.alpha})},n.prototype.analyse=function(e){this._options.positions=e,setTimeout((()=>{this.$emit("calc-start")}),0);let i=this._options.style,n=this.instance;if(!n){let o=l(i.lineColor),r=l(i.fillColor),s=l(i.cutColor);n=new t.CutAndFillVolume,n.baseHeight=i.baseHeight,n.lineColor=t.Color.fromRgb(o.r,o.g,o.b,255*i.alpha),n.fillVolumeColor=t.Color.fromRgb(r.r,r.g,r.b,255*i.alpha),n.cutVolumeColor=t.Color.fromRgb(s.r,s.g,s.b,255*i.alpha);for(let t=0;t<e.length;t++)n.addPoint(e[t]);this.instance=n}n.computeCutVolume(),n.readyPromise.then((()=>{let t=n.fillVolume(),o=n.cutVolume(),r=n.minHeight(),s=n.maxHeight(),a=i.baseHeight-r,l=s-i.baseHeight;a>0&&l>0&&(this._volume&&this._volume.delete(),this._volume=this.drawFillVolume(e,i.baseHeight)),setTimeout((()=>{this.$emit("calc-end",o,t,r,s)}),0)}))},n.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null),this._volume&&(this._volume.delete(),this._volume=null)},Object.defineProperties(n.prototype,{baseHeight:{get(){return this._options.style.baseHeight},set(t){this._options.style.baseHeight=t,this.instance&&(this.instance.baseHeight=t,this.analyse(this._options.positions))}}}),n},FlattenMask:function(t,e){function n(t){this._options=s({type:"rect",mode:"tileset",tileset:null,positions:null,height:0},t),this.instance=null,K(this),this.initData(this._options)}return tt(n),n.prototype.initData=function(t){let e=t.positions;if(e){let t=j(e);this.analyse(t)}else this.drawPolygon()},n.prototype.drawPolygon=function(){let t=this,e=new i.graphic.Polygon({type:this._options.type,style:{mode:"OnTerrain",color:"#ff0000",alpha:.3,fillAlpha:.3}});e.$on("end",(function(){e.remove(),t.analyse(this.cache.points)}))},n.prototype.analyse=function(i){let n=this._options.mode,o=this._options.tileset,r=this._options.height;"globe"==n&&(o=e.scene.globe);let s=new t.FlattenMask;return s.maskHeight=r,s.setPoints(i),o.addFlattenMask(s),this.instance=s,this.$emit("end",this._options.mode),s},n.prototype.remove=function(){if(this.instance){let t=this._options.mode,i=this._options.tileset;"globe"==t&&(i=e.scene.globe),i.removeFlattenMask(this.instance),this.instance.delete(),this.instance=null}},Object.defineProperties(n.prototype,{height:{get(){return this.instance.maskHeight},set(t){this.instance.maskHeight=t}}}),n},Sunlight:function(t,e){let i=null;function n(t){if(i&&!t.toImage)return i;{let e={maxTime:"",style:{speed:1600,castShow:!0}};this._options=s(e,t),K(this);let n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate());this.timer=null,this.startDate=o,this.currentTime=o.getTime(),this.playing=!1,this.create(this._options),i=this}}return tt(n),n.prototype.create=function(t){let i=t.style;e.scene.sun.castShadow=i.castShow},n.prototype.play=function(){let i=this._options.style;if(this.playing=!0,!this.timer){this.currentTime=this.startDate.getTime();let n=e.scene,o=new t.FrameAction;o.onTriggered((t=>{if(!this.playing)return;let e=this.startDate.getTime()+864e5,n=t*i.speed*1e3,o=this.currentTime+n;if(o>e)return this.playing=!1,this.timer.delete(),void(this.timer=null);let r=new Date(o);this.$emit("animating",r),this.setTime(r)})),n.rootEntity.addComponent(o),this.timer=o}},n.prototype.setTime=function(t){this.startDate=new Date(t.getFullYear(),t.getMonth(),t.getDate()),this.currentTime=t.getTime();let i=e.timeSystem;i.setYear(t.getFullYear()),i.setMonth(t.getMonth()+1),i.setDay(t.getDate()),i.setHour(t.getHours()),i.setMinute(t.getMinutes())},n.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},n}},graphic:Re,effects:{ArcLayer:function(t,e){function i(t){this._options=s({data:null,dataUrl:"",style:{lineWidth:2,height:1,startColor:"#00ff00",endColor:"#0000ff",imgUrl:"",repeat:null,animation:null}},t),this.instance=null,this.initData(this._options)}return i.prototype.initData=function(t){let e=t.data,i=t.dataUrl;if(!e&&!i)throw new Error("数据参数data或dataUrl为空！");this.instance=this.render(t)},i.prototype.render=function(e){let i=e.style,n=new t.ArcLayer;n.lineWidth=i.lineWidth;let o=l(i.startColor);n.setStartColor(t.Color.fromRgb(o.r,o.g,o.b,255));let r=l(i.endColor);n.setEndColor(t.Color.fromRgb(r.r,r.g,r.b,255)),n.height=i.height,i.imgUrl&&(n.setImageUrl(i.imgUrl),i.repeat&&n.setRepeat(i.repeat));let s=i.animation;s&&(n.animationRun=!0,n.animationTimer=s.duration||3);let a=e.data;return a?a.forEach((t=>{n.addString(JSON.stringify(t))})):n.setNDJsonFile(e.dataUrl),n.create(),n},i.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},i},GeoFencing:function(t,e){function i(t){this._options=s({type:"circle",centerPos:null,positions:null,style:{radius:100,height:60,segment:60,startColor:"#00ffff",endColor:"#0000ff",imageUrl:"",scaleX:1,scaleY:1,animation:null}},t),this.instance=null,K(this),this.initData(this._options)}return tt(i),i.prototype.initData=function(e){let i=e.positions,n=e.style;if("polygon"==e.type&&i){let e=j(i),n=new t.Cartesian3Vector;e.forEach((t=>{n.push_back(t.toCartesian3())})),this.render(n)}else{if(!e.centerPos)throw new Error("位置参数centerPos或positions为空！");{let i=j([e.centerPos]),o=t.GisUtil.computeShape2GeodeticSurface(n.radius,n.height,i[0]);this.render(o)}}},i.prototype.render=function(e){let i=this._options.style,n=new t.GeoFencing;n.setOuter(e),n.extrudeHeight=i.height;let o=l(i.startColor),r=l(i.endColor);n.setColorRamp(t.Color.fromRgb(o.r,o.g,o.b,255),t.Color.fromRgb(r.r,r.g,r.b,255)),i.imgUrl&&(n.url=i.imgUrl,n.textureScale=t.Vector2.create(i.scaleX,i.scaleY));let s=i.animation;s&&(n.setAnimationRun(!0),n.setRange(s.range||.5),n.setAnimationTimer(s.duration||2),n.animationDirection="vertical"==s.direction?t.AnimatingUVCoords.UDirection:t.AnimatingUVCoords.VDirection,n.cw=s.cw||!0),n.create()},i.prototype.remove=function(){this.instance&&(this.instance.delete(),this.instance=null)},i}},ParticleSystem:function(t,e){function i(){this._ParticlesObjects={},this._ParticlesidList=[],this._nowid=null,this._particleentity=null}return Object.defineProperties(i.prototype,{id:{get(){return this._nowid}},particleentity:{get(){return this._particleentity}},ParticleCollection:{get(){let t=[];for(let e in this._ParticlesObjects){let i={id:e,entity:this._ParticlesObjects[e]};t.push(i)}return t}},show:{get(){return this._particleentity?this._particleentity.enabled:null},set(t){this._particleentity&&(this._particleentity.enabled=t)}},_cirparticle:{get:()=>({type:"cirparticle",emitteropt:{emitRate:80,lifeSpan:4e3,shapeType:2,fillShape:!0,size:[4,4],endSize:[4,4],shapeSize:[1,1],sizeVariation:[1,1],velocity:{direction:[.1,.1,.1],variation:[13,13,13]},acceleration:{direction:[1,1,1],variation:[1,1,1]}},renderer:{color:"rgba(0, 204, 255, 1)",colorVariation:0,alpha:.55,alphaVariation:.01,alignedAxis:[0,0,0],blendMode:"NormalBlend",image:"/assets/images/particle/particle1.png"}})},_particleshapetype:{get:()=>({0:t.ParticleShapeType.Line,1:t.ParticleShapeType.Rectangle,2:t.ParticleShapeType.Ellipse})},_fireparticle:{get:()=>({type:"fireparticle",emitteropt:{emitRate:200,lifeSpan:4e3,shapeType:1,fillShape:!0,size:[16,16],endSize:[2,2],shapeSize:[40,20],sizeVariation:[0,0],velocity:{direction:[0,0,0],variation:[1,1,0]},acceleration:{direction:[0,0,8],variation:[1,1,0]}},renderer:{color:"rgba(254, 138, 73, 1)",colorVariation:.1,alpha:.35,alphaVariation:.1,alignedAxis:[0,0,0],blendMode:"NormalBlend",image:"/assets/images/particle/glowdot2.png"}})},_blastparticle:{get:()=>({type:"blastparticle",emitteropt:{emitRate:550,lifeSpan:1400,shapeType:1,fillShape:!0,size:[30,30],endSize:[2,2],shapeSize:[40,20],sizeVariation:[0,0],velocity:{direction:[0,0,0],variation:[55,55,55]},acceleration:{direction:[0,0,8],variation:[55,55,55]}},renderer:{color:"rgba(254, 138, 73, 1)",colorVariation:.1,alpha:.35,alphaVariation:.1,alignedAxis:[0,0,0],blendMode:"NormalBlend",image:"/assets/images/particle/glowdot2.png"}})},_tailflameparticle:{get:()=>({type:"tailflameparticle",emitteropt:{emitRate:1300,lifeSpan:1680,shapeType:1,fillShape:!0,size:[5,5],endSize:[1,1],shapeSize:[5,5],sizeVariation:[0,0],velocity:{direction:[0,0,-30],variation:[1,1,0]},acceleration:{direction:[0,0,-30],variation:[1,1,-60]}},renderer:{color:"rgba(254, 138, 73, 1)",colorVariation:.1,alpha:.35,alphaVariation:.1,alignedAxis:[0,0,-2],blendMode:"NormalBlend",image:"/assets/images/particle/glowdot2.png"}})},_smokeparticle:{get:()=>({type:"smokeparticle",emitteropt:{emitRate:120,lifeSpan:8e3,shapeType:2,fillShape:!0,size:[6,6],endSize:[35,35],shapeSize:[40,20],sizeVariation:[6,6],velocity:{direction:[.5,.5,.2],variation:[2,2,0]},acceleration:{direction:[1,1,4],variation:[1,1,1]}},renderer:{color:"rgba(25, 25, 25, 1)",colorVariation:0,alpha:.15,alphaVariation:.05,alignedAxis:[0,0,0],blendMode:"NormalBlend",image:"/assets/images/particle/smoke.png"}})},_watercolparticle:{get:()=>({type:"watercolparticle",emitteropt:{emitRate:1200,lifeSpan:1500,shapeType:2,fillShape:!0,size:[5,5],endSize:[10,10],shapeSize:[1,1],sizeVariation:[0,0],velocity:{direction:[15,0,0],variation:[0,0,2]},acceleration:{direction:[20,0,0],variation:[0,0,.5]}},renderer:{color:"rgba(220, 235, 255, 1)",colorVariation:0,alpha:.8,alphaVariation:0,alignedAxis:[1,0,0],blendMode:"AdditiveBlend",image:"/assets/images/particle/pressuriseWater.png"}})},_watercolarcparticle:{get:()=>({type:"watercolarcparticle",emitteropt:{emitRate:2200,lifeSpan:2500,shapeType:2,fillShape:!0,size:[5,5],endSize:[10,10],shapeSize:[1,1],sizeVariation:[0,0],velocity:{direction:[15,0,15],variation:[0,0,1.2]},acceleration:{direction:[8,0,-20],variation:[0,0,.5]}},renderer:{color:"rgba(220, 235, 255, 1)",colorVariation:0,alpha:.9,alphaVariation:0,alignedAxis:[1,0,0],blendMode:"AdditiveBlend",image:"/assets/images/particle/pressuriseWater.png"}})},_fountainparticle:{get:()=>({type:"fountainparticle",emitteropt:{emitRate:3200,lifeSpan:1800,shapeType:1,fillShape:!0,size:[3,3],endSize:[5,5],shapeSize:[1,1],sizeVariation:[0,0],velocity:{direction:[0,0,50],variation:[5.5,5.5,0]},acceleration:{direction:[0,0,-80],variation:[0,0,0]}},renderer:{color:"rgba(220, 235, 255, 1)",colorVariation:0,alpha:.9,alphaVariation:0,alignedAxis:[0,0,1],blendMode:"AdditiveBlend",image:"/assets/images/particle/pressuriseWater.png"}})},_rainparticle:{get:()=>({type:"rainparticle",emitteropt:{emitRate:5e3,lifeSpan:3e3,shapeType:2,fillShape:!0,size:[8,8],endSize:[6,6],shapeSize:[1e4,8e3],sizeVariation:[2,6],velocity:{direction:[0,0,-400],variation:[1,1,0]},acceleration:{direction:[0,0,-300],variation:[1,1,0]}},renderer:{color:"rgba(220, 235, 255, 1)",colorVariation:0,alpha:.6,alphaVariation:.2,alignedAxis:[.1,.1,1],blendMode:"AdditiveBlend",image:"/assets/images/particle/rain.png"}})},_snowparticle:{get:()=>({type:"snowparticle",emitteropt:{emitRate:1300,lifeSpan:2e4,shapeType:1,fillShape:!0,size:[5,5],endSize:[5,5],shapeSize:[1e4,8e3],sizeVariation:[2,1],velocity:{direction:[0,0,-10],variation:[8,8,-1]},acceleration:{direction:[0,0,-2],variation:[1,1,0]}},renderer:{color:"rgba(255, 255, 255, 1)",colorVariation:0,alpha:.8,alphaVariation:0,alignedAxis:[0,0,0],blendMode:"AdditiveBlend",image:"/assets/images/particle/snow.png"}})},_fogparticle:{get:()=>({type:"fogparticle",emitteropt:{emitRate:1400,lifeSpan:1e4,shapeType:2,fillShape:!0,size:[12,12],endSize:[12,12],shapeSize:[1e3,1e3],sizeVariation:[5,5],velocity:{direction:[.2,.2,.2],variation:[.2,.2,.2]},acceleration:{direction:[.5,.5,-.8],variation:[1,1,1]}},renderer:{color:"rgba(180, 180, 180, 1)",colorVariation:0,alpha:.09,alphaVariation:0,alignedAxis:[0,0,0],blendMode:"AdditiveBlend",image:"/assets/images/particle/smoke.png"}})}}),i.prototype.getparticleparBytype=function(t){return this["_"+t]},i.prototype.createParticle=function(e){let i=e,n=t.Cartographic.fromDegrees(e.position.longitude,e.position.latitude,e.position.height<=0?1:e.position.height);if(e.imgurl&&(i.renderer.image=e.imgurl),i){let t=this._createParticleSystem(n,i);return this._ParticlesObjects[t.id]={attr:i,entity:t.particleentity},this._nowid=t.id,this._ParticlesidList.push(t.id),this._particleentity=t.particleentity,t}},i.prototype._createParticleSystem=function(i,n){var o=new t.ParticleSystem;let r=n.emitteropt,s=this._createParticleEmitter(r);o.addEmitter(s);let a=this._createImageParticleRenderer(n.renderer);o.addRenderer(a);var l=new t.Entity;return l.transform.cartographic=i,l.addComponent(o),l.objectName=n.type,e.scene.addEntity(l),{particleentity:l,id:n.id||h()}},i.prototype.getparticleById=function(t){let e=this._ParticlesObjects[t];return e||null},i.prototype.showById=function(t,e){t&&this._ParticlesObjects[t]&&(this._ParticlesObjects[t].entity.enabled=e||!this._ParticlesObjects[t].entity.enabled)},i.prototype.updateById=function(t){if(this._nowid=t.id||this._nowid,this._nowid){let e=this._ParticlesObjects[this._nowid];if(e){t.position&&(t.position.height&&(e.attr.position.height=t.position.height),t.position.latitude&&(e.attr.position.latitude=t.position.latitude),t.position.longitude&&(e.attr.position.longitude=t.position.longitude));let i={id:this._nowid,position:e.attr.position,type:e.attr.type,emitteropt:t.emitteropt,renderer:t.renderer};this.removeById(t.id),this.createParticle(i)}}},i.prototype.remove=function(){if(this._nowid){this._ParticlesObjects[this._nowid].entity.delete(),delete this._ParticlesObjects[this._nowid];let t=this._ParticlesidList.indexOf(this._nowid);this._ParticlesidList.splice(t,1),this._ParticlesidList.length>0?(this._nowid=this._ParticlesidList[this._ParticlesidList.length-1],this._particleentity=this._ParticlesObjects[this._nowid].particleentity):(this._nowid=null,this._particleentity=null)}},i.prototype.removeById=function(t){if(t){this._ParticlesObjects[t].entity.delete(),delete this._ParticlesObjects[t];let e=this._ParticlesidList.indexOf(this._nowid);this._ParticlesidList.splice(e,1),this._ParticlesidList.length>0?(this._nowid=this._ParticlesidList[this._ParticlesidList.length-1],this._particleentity=this._ParticlesObjects[this._nowid].particleentity):(this._nowid=null,this._particleentity=null)}},i.prototype.removeByType=function(t){for(let e in this._ParticlesObjects){let i=this._ParticlesObjects[e];if(i.attr.type===t){i.entity.delete(),delete this._ParticlesObjects[e];let t=this._ParticlesidList.indexOf(e);this._ParticlesidList.splice(t,1)}}this._ParticlesidList.length>0?(this._nowid=this._ParticlesidList[this._ParticlesidList.length-1],this._particleentity=this._ParticlesObjects[this._nowid].particleentity):(this._nowid=null,this._particleentity=null)},i.prototype.removeAll=function(){this._ParticlesidList.forEach((t=>{this._ParticlesObjects[t].entity.delete(),delete this._ParticlesObjects[t]})),this._ParticlesidList=[],this._nowid=null,this._particleentity=null},i.prototype._createParticleEmitter=function(e){var i=new t.ParticleEmitter;let n=this._particleshapetype;return i.shapeType=n[e.shapeType],i.shapeSize=t.Vector2.create(e.shapeSize[0],e.shapeSize[1]),i.fillShape=e.fillShape,i.size=t.Vector2.create(e.size[0],e.size[1]),i.endSize=t.Vector2.create(e.endSize[0],e.endSize[1]),i.sizeVariation=t.Vector2.create(e.sizeVariation[0],e.sizeVariation[1]),i.emitRate=e.emitRate,i.lifeSpan=e.lifeSpan,i.velocity=this._createParticlePointDirection(e.velocity),i.acceleration=this._createParticlePointDirection(e.acceleration),i},i.prototype._createParticlePointDirection=function(e){var i=new t.ParticlePointDirection;return i.x=e.direction[0],i.y=e.direction[1],i.z=e.direction[2],i.xVariation=e.variation[0],i.yVariation=e.variation[1],i.zVariation=e.variation[2],i},i.prototype._createImageParticleRenderer=function(e){var i=new t.ImageParticleRenderer;let n=(o=e.color,r=o.split("(")[1].split(")")[0].split(","),{r:Number(r[0]),g:Number(r[1]),b:Number(r[2]),a:parseInt(255*Number(r[3]))});var o,r;return i.color=t.Color.fromRgb(n.r,n.g,n.b,n.a),i.colorVariation=e.colorVariation,i.alpha=e.alpha,i.alphaVariation=e.alphaVariation,i.alignedAxis=t.Vector3.create(e.alignedAxis[0],e.alignedAxis[1],e.alignedAxis[2]),i.blendMode=t.ParticleBlendMode[e.blendMode],i.image=e.image,i},i}};return i.use(Ne),i}));
